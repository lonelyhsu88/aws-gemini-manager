# AWS Operations Log

æ­¤æ–‡ä»¶è¨˜éŒ„æ‰€æœ‰ AWS ç®¡ç†æ“ä½œçš„æ­·å²ï¼Œä¾› Claude Code åœ¨æ–°å°è©±æ™‚åƒè€ƒã€‚

---

## 2025-10-28

### é …ç›®åˆå§‹åŒ–
- å‰µå»º aws-gemini-manager é …ç›®
- è¨­å®š AWS Profile: `gemini-pro_ck`
- å‰µå»ºé…ç½®æ–‡æª”ï¼šCLAUDE.md, README.md, .claude/context.json

### RDS æŸ¥è©¢

**ä»»å‹™**: æŸ¥è©¢ç›®å‰æœ‰å¤šå°‘ RDS instances

**åŸ·è¡Œå‘½ä»¤**:
```bash
aws --profile gemini-pro_ck rds describe-db-instances
```

**æŸ¥è©¢çµæœ**:
- **ç¸½æ•¸**: 10 å€‹ RDS å¯¦ä¾‹
- **ç‹€æ…‹**: å…¨éƒ¨ available
- **å¼•æ“**: å…¨éƒ¨ä½¿ç”¨ PostgreSQL
- **å€åŸŸ**: ap-east-1

**å¯¦ä¾‹æ¸…å–®**:
1. `bingo-prd` - db.m6g.large (ç”Ÿç”¢ä¸»åº«)
2. `bingo-prd-replica1` - db.m6g.large (ç”Ÿç”¢åªè®€å‰¯æœ¬)
3. `bingo-prd-backstage` - db.m6g.large (ç”Ÿç”¢å¾Œå°)
4. `bingo-prd-backstage-replica1` - db.t4g.medium (ç”Ÿç”¢å¾Œå°å‰¯æœ¬)
5. `bingo-prd-loyalty` - db.t4g.medium (ç”Ÿç”¢å¿ èª åº¦ç³»çµ±)
6. `bingo-stress` - db.t4g.medium (å£“æ¸¬ç’°å¢ƒ)
7. `bingo-stress-backstage` - db.t4g.medium (å£“æ¸¬å¾Œå°)
8. `bingo-stress-loyalty` - db.t4g.medium (å£“æ¸¬å¿ èª åº¦)
9. `pgsqlrel` - db.t3.small (é—œè¯å¼è³‡æ–™åº«)
10. `pgsqlrel-backstage` - db.t3.micro (é—œè¯å¼è³‡æ–™åº«å¾Œå°)

**é‡è¦ç™¼ç¾**:
- ç”Ÿç”¢ç’°å¢ƒä½¿ç”¨è¼ƒå¤§è¦æ ¼ (m6g.large)
- æœ‰è¨­å®š read replica æå‡è®€å–æ•ˆèƒ½
- å£“æ¸¬ç’°å¢ƒä½¿ç”¨è¼ƒå°è¦æ ¼ (t4g.medium)

### ç”¨æˆ¶éœ€æ±‚ç¢ºèª
- **ç®¡ç†æ–¹å¼**: é€é Claude Code ç›´æ¥æŸ¥è©¢å’Œç®¡ç† AWS è³‡æº
- **ä¸éœ€è¦**: è‡ªå‹•å‰µå»ºç®¡ç†è…³æœ¬ï¼ˆé™¤éæ˜ç¢ºè¦æ±‚ï¼‰
- **éœ€è¦**: è¨˜éŒ„æ‰€æœ‰æ“ä½œæ­·å²ï¼Œé¿å…ä¸‹æ¬¡å°è©±éºå¿˜
- **å¯¦ä½œç­–ç•¥**: æ··åˆä½¿ç”¨ Shell Script (AWS CLI) å’Œ Python (Boto3)
  - ç°¡å–®æŸ¥è©¢ â†’ AWS CLI
  - è¤‡é›œæ“ä½œ â†’ Boto3

### EC2 CPU è² è¼‰æŸ¥è©¢

**ä»»å‹™**: æŸ¥è©¢æ‰€æœ‰ EC2 instances è² è¼‰æœ€é«˜çš„

**åŸ·è¡Œå‘½ä»¤**:
```bash
# 1. åˆ—å‡ºæ‰€æœ‰é‹è¡Œä¸­çš„å¯¦ä¾‹ (91 å€‹)
aws --profile gemini-pro_ck ec2 describe-instances --filters "Name=instance-state-name,Values=running"

# 2. æŸ¥è©¢æ¯å€‹å¯¦ä¾‹çš„ CloudWatch CPU æŒ‡æ¨™ï¼ˆéå» 15 åˆ†é˜å¹³å‡ï¼‰
aws --profile gemini-pro_ck cloudwatch get-metric-statistics \
  --namespace AWS/EC2 \
  --metric-name CPUUtilization \
  --dimensions Name=InstanceId,Value=<instance_id> \
  --start-time <15min_ago> \
  --end-time <now> \
  --period 900 \
  --statistics Average
```

**æŸ¥è©¢çµæœ** - CPU ä½¿ç”¨ç‡ Top 10:
1. ğŸ”´ `hash-rel-srv-01` (i-09f5b89a51db5cb7e) - t3.large - **41.34%** âš ï¸
2. ğŸŸ  `els-elk-prd-01` (i-0283c28d4f94b8f68) - c5a.2xlarge - 28.35%
3. ğŸŸ  `els-elk-rel-01` (i-0743f603627230870) - t3.xlarge - 24.84%
4. ğŸŸ¡ `hash-prd-gate-01` (i-038d9e1c293587c56) - t3.large - 23.52%
5. ğŸŸ¡ `prd-backend-api-01` (i-0bc1598c8f115d2cf) - t3.medium - 14.55%
6. ğŸŸ¡ `prd-loyalty-srv-01` (i-0adfbe22ab0170c10) - t3.large - 14.40%
7. ğŸŸ¢ `Bingo-Rel-Srv-01` (i-0156659c38fa6ee66) - t3.xlarge - 11.96%
8. ğŸŸ¢ `els-prometheus-n8n-01` (i-06ff53ed9ffb2e1de) - t3.medium - 11.31%
9. ğŸŸ¢ `els-prd-logstash-01` (i-0b3f2551636dfdbf1) - t3.large - 10.19%
10. ğŸŸ¢ `els-jenkins-slave-01` (i-0022ff0301db0bf1f) - t3.small - 9.43%

**é‡è¦ç™¼ç¾**:
- `hash-rel-srv-01` CPU è² è¼‰æœ€é«˜ï¼Œé” 41.34%ï¼Œéœ€è¦é—œæ³¨
- ELK ç›¸é—œæœå‹™ï¼ˆelk-prd, elk-relï¼‰è² è¼‰è¼ƒé«˜ï¼ˆ24-28%ï¼‰
- å¤§éƒ¨åˆ†å¯¦ä¾‹ CPU ä½¿ç”¨ç‡æ­£å¸¸ï¼ˆ< 15%ï¼‰

### RDS ç©ºé–“ä½¿ç”¨ç‹€æ³æŸ¥è©¢

**ä»»å‹™**: æŸ¥è©¢æ‰€æœ‰ RDS è³‡æ–™åº«çš„ç©ºé–“ä½¿ç”¨ç‹€æ³

**åŸ·è¡Œå‘½ä»¤**:
```bash
# 1. æŸ¥è©¢é…ç½®çš„å„²å­˜ç©ºé–“
aws --profile gemini-pro_ck rds describe-db-instances \
  --query 'DBInstances[*].[DBInstanceIdentifier,AllocatedStorage]'

# 2. æŸ¥è©¢å¯¦éš›ä½¿ç”¨ç‹€æ³ï¼ˆCloudWatch FreeStorageSpace æŒ‡æ¨™ï¼‰
aws --profile gemini-pro_ck cloudwatch get-metric-statistics \
  --namespace AWS/RDS \
  --metric-name FreeStorageSpace \
  --dimensions Name=DBInstanceIdentifier,Value=<db_id> \
  --start-time <1h_ago> \
  --end-time <now> \
  --period 3600 \
  --statistics Average
```

**æŸ¥è©¢çµæœ** - ç©ºé–“ä½¿ç”¨ç‡ Top 5:
1. ğŸ”´ `bingo-prd-replica1` - 2662 GB / å·²ç”¨ 2231 GB - **83%** âš ï¸âš ï¸
2. ğŸ”´ `bingo-prd` - 2750 GB / å·²ç”¨ 2264 GB - **82%** âš ï¸âš ï¸
3. ğŸ”´ `bingo-prd-backstage-replica1` - 1465 GB / å·²ç”¨ 1214 GB - **82%** âš ï¸âš ï¸
4. ğŸŸ  `bingo-stress` - 2750 GB / å·²ç”¨ 2219 GB - **80%** âš ï¸
5. ğŸŸ  `pgsqlrel` - 40 GB / å·²ç”¨ 28.53 GB - **71%**

**é‡è¦ç™¼ç¾**:
- âš ï¸ **ç·Šæ€¥**: 3 å€‹ç”Ÿç”¢è³‡æ–™åº«ä½¿ç”¨ç‡è¶…é 80%ï¼Œæ¥è¿‘å®¹é‡ä¸Šé™
- `bingo-prd-replica1` å‰©é¤˜ç©ºé–“åƒ… 430 GB
- `bingo-prd-backstage-replica1` å‰©é¤˜ç©ºé–“åƒ… 250 GB
- éœ€è¦è€ƒæ…®æ“´å……å„²å­˜ç©ºé–“æˆ–æ¸…ç†èˆŠè³‡æ–™

**å»ºè­°å¾ŒçºŒå‹•ä½œ**:
1. ç›£æ§ `bingo-prd` ç³»åˆ—è³‡æ–™åº«çš„ç©ºé–“å¢é•·è¶¨å‹¢
2. æª¢æŸ¥æ˜¯å¦æœ‰å¤§å‹è¡¨æ ¼å¯ä»¥æ­¸æª”
3. è¨­å®š CloudWatch å‘Šè­¦ï¼ˆ85% é–¾å€¼ï¼‰
4. è©•ä¼°æ“´å……å„²å­˜ç©ºé–“çš„å¿…è¦æ€§

### RDS å„²å­˜ç©ºé–“ 2025 å¹´å®Œæ•´è¶¨å‹¢åˆ†æ

**ä»»å‹™**: æŸ¥è©¢æ‰€æœ‰ RDS å¯¦ä¾‹éå» 300 å¤©ï¼ˆ2025-01-01 è‡³ä»Šï¼‰çš„å„²å­˜ç©ºé–“è®ŠåŒ–è¶¨å‹¢

**åŸ·è¡Œæ–¹æ³•**: ä½¿ç”¨ Python + Boto3 æŸ¥è©¢ CloudWatch æŒ‡æ¨™

**é—œéµç™¼ç¾**:

1. **å…©æ¬¡å¤§è¦æ¨¡è³‡æ–™æ¸…ç†äº‹ä»¶**
   - `bingo-prd-backstage`: å¾ 4,819 GB (96%) é™è‡³ 1,278 GB (25%) - æ¸›å°‘ 3,541 GB
   - `bingo-stress-backstage`: å¾ 4,742 GB (94%) é™è‡³ 1,265 GB (25%) - æ¸›å°‘ 3,477 GB
   - æ¸…ç†æ™‚é–“é»: ä¸»è¦åœ¨ 10æœˆ22-23æ—¥

2. **ç‹€æ…‹åˆ†é¡**:
   - ğŸ”´ CRITICAL (4å€‹): bingo-prd (82%), bingo-prd-replica1 (84%), bingo-prd-backstage-replica1 (83%), bingo-stress (81%)
     - ä½†éƒ½å‘ˆç¾ç©©å®šä¸‹é™è¶¨å‹¢ï¼Œæš«æ™‚å®‰å…¨
   - ğŸŸ  WARNING (1å€‹): pgsqlrel (71%) - é è¨ˆ 2026-06-01 æ»¿è¼‰
   - ğŸŸ¡ MODERATE (3å€‹): ä½¿ç”¨ç‡ 58-64%
   - ğŸŸ¢ GOOD (2å€‹): éåº¦é…ç½®ï¼Œä½¿ç”¨ç‡åƒ… 25%

3. **æˆæœ¬å„ªåŒ–æ©Ÿæœƒ** - å¹´ç¯€çœæ½›åŠ› $6,000-7,200
   - `bingo-prd-backstage`: 5,024 GB â†’ 2,000 GB å»ºè­° (ç¯€çœ $302/æœˆ)
   - `bingo-stress-backstage`: 5,024 GB â†’ 2,000 GB å»ºè­° (ç¯€çœ $302/æœˆ)
   - åˆè¨ˆ: **$604/æœˆ = $7,248/å¹´**

### ä¸‰é …æ·±åº¦åˆ†æä»»å‹™ï¼ˆä½¿ç”¨ Agent ä¸¦è¡ŒåŸ·è¡Œï¼‰

#### 1. RDS ç¸®æ¸›å„²å­˜ç©ºé–“æ–¹æ³•ç ”ç©¶

**ä»»å‹™**: ç ”ç©¶æ‰€æœ‰å¯è¡Œçš„ RDS å„²å­˜ç©ºé–“ç¸®æ¸›æ–¹æ³•ä¸¦æ¯”è¼ƒ

**åˆ†æçµæœ**:
- ç ”ç©¶äº† 8 ç¨®æ–¹æ³•
- **ç¬¬ä¸€æ¨è–¦**: Blue/Green Deploymentï¼ˆAWS 2024å¹´11æœˆæ–°åŠŸèƒ½ï¼‰
  - åœæ©Ÿæ™‚é–“: < 1 åˆ†é˜
  - æˆæœ¬: $150-350
  - éœ€ç¢ºèª ap-east-1 å€åŸŸæ”¯æ´
- **ç¬¬äºŒæ¨è–¦**: PostgreSQL é‚è¼¯è¤‡è£½
  - åœæ©Ÿæ™‚é–“: < 5 åˆ†é˜
  - ç„¡é¡å¤–æœå‹™æˆæœ¬
- âŒ å¿«ç…§é‚„åŸ: AWS ä¸æ”¯æ´é‚„åŸåˆ°è¼ƒå°å„²å­˜ç©ºé–“

**ç”Ÿæˆæ–‡æª”**:
- `docs/rds-resize-methods-comparison.md` - è©³ç´°æ–¹æ³•æ¯”è¼ƒ

#### 2. RDS å¥åº·åº¦å…¨é¢åˆ†æ

**ä»»å‹™**: åˆ†ææ‰€æœ‰ 10 å€‹ RDS å¯¦ä¾‹çš„å¥åº·ç‹€æ³

**é—œéµç™¼ç¾**:
- **æ•´é«”å¥åº·è©•åˆ†**: 65/100 (ğŸŸ¡ éœ€è¦å„ªåŒ–)
- **ç·Šæ€¥å•é¡Œ**:
  - `pgsqlrel-backstage`: è¨˜æ†¶é«”åƒ… 50 MB å¯ç”¨ (5%) - éœ€ç«‹å³å‡ç´š
  - `pgsqlrel`: è¨˜æ†¶é«”åƒ… 520 MB å¯ç”¨ (26%)
  - **IOPS åš´é‡éåº¦é…ç½®**: 6å€‹å¯¦ä¾‹ä½¿ç”¨ç‡åƒ… 0.5-3.8%ï¼Œæµªè²» $5,750/æœˆ
- **å®‰å…¨æ€§å•é¡Œ**:
  - æ‰€æœ‰å¯¦ä¾‹æœªå•Ÿç”¨ Multi-AZ
  - æ‰€æœ‰å¯¦ä¾‹é–‹æ”¾å…¬é–‹è¨ªå•
  - å‚™ä»½ä¿ç•™å¤©æ•¸ä¸è¶³ï¼ˆ1-3å¤©ï¼‰
- **æˆæœ¬å„ªåŒ–æ½›åŠ›**:
  - ç•¶å‰æˆæœ¬: $10,232/æœˆ ($122,784/å¹´)
  - å„ªåŒ–å¾Œå¯ç¯€çœ: $6,350/æœˆ ($76,200/å¹´)
  - ç¯€çœæ¯”ä¾‹: **57%**

**å„ªåŒ–å»ºè­°å„ªå…ˆåº**:
1. ç¬¬1é€±: pgsqlrel è¨˜æ†¶é«”å‡ç´š (+$40/æœˆ) + IOPS é™ç´š (-$5,750/æœˆ)
2. ç¬¬2-3é€±: åˆ†éšæ®µåŸ·è¡Œ IOPS å„ªåŒ–
3. ç¬¬4é€±: å•Ÿç”¨ Multi-AZ é—œéµå¯¦ä¾‹
4. é•·æœŸ: Reserved Instancesã€å®‰å…¨æ€§åŠ å›º

**ç”Ÿæˆæ–‡æª”**:
- `docs/rds-health-report.md` - è©³ç´°å¥åº·å ±å‘Š
- `docs/rds-health-summary.md` - åŸ·è¡Œæ‘˜è¦
- `docs/rds-health-visual-summary.txt` - è¦–è¦ºåŒ–ç¸½è¦½

#### 3. Security Group é…ç½®åˆ†æ

**ä»»å‹™**: åˆ†æ Security Group æ˜¯å¦æ··äº‚ä¸¦æä¾›å„ªåŒ–å»ºè­°

**åˆ¤æ–·çµæœ**: **æ˜¯ï¼Œä¸­ç­‰æ··äº‚** (ğŸŸ¡ è©•åˆ† 5/10)

**çµ±è¨ˆæ•¸æ“š**:
- ç¸½æ•¸: 161 å€‹ Security Groups
- ä½¿ç”¨ç‡: 68.9% (111å€‹ä½¿ç”¨ä¸­ï¼Œ50å€‹æœªä½¿ç”¨)
- é«˜é¢¨éšª: 4å€‹ (SSH/DB ç«¯å£æš´éœ²æ–¼ç¶²éš›ç¶²è·¯)
- å‘½åæ¨¡å¼: 34ç¨®ä¸åŒæ¨¡å¼ï¼Œå­˜åœ¨å¤§å°å¯«ä¸ä¸€è‡´

**ä¸»è¦å•é¡Œ**:
1. **å®‰å…¨é¢¨éšª**:
   - 3å€‹ SG å°‡ SSH (22) æš´éœ²æ–¼ 0.0.0.0/0
   - 1å€‹ SG å°‡è³‡æ–™åº«ç«¯å£æš´éœ²æ–¼ç¶²éš›ç¶²è·¯
2. **è³‡æºæµªè²»**: 48å€‹ (29.8%) Security Groups æœªä½¿ç”¨
3. **ç®¡ç†æ··äº‚**: å‘½åä¸è¦ç¯„ (Hash/hash, Bingo/bingo)
4. **è¦å‰‡çµ±è¨ˆ**: 494æ¢ Inboundï¼Œ154æ¢ Outboundï¼Œ25æ¢é–‹æ”¾ 0.0.0.0/0

**å„ªåŒ–å»ºè­°**:
- éšæ®µ0 (ç·Šæ€¥): ä¿®å¾© SSH/DB ç«¯å£æš´éœ² (1-2å¤©)
- éšæ®µ1: æ¸…ç† 48å€‹æœªä½¿ç”¨ Security Groups (1-2é€±)
- éšæ®µ2: æ¨™æº–åŒ–å‘½åå’Œè¦ç¯„ (2-4é€±)
- éšæ®µ3: Terraform IaC å’Œè‡ªå‹•åŒ– (1-3å€‹æœˆ)

**ç”Ÿæˆæ–‡æª”**:
- `docs/security-group-analysis.md` - è©³ç´°åˆ†æå ±å‘Š
- `docs/security-group-optimization-plan.md` - å„ªåŒ–è¡Œå‹•è¨ˆç•«
- `docs/security-group-visual-summary.txt` - è¦–è¦ºåŒ–æ‘˜è¦
- `scripts/check-sg-risks.sh` - è‡ªå‹•é¢¨éšªæª¢æŸ¥è…³æœ¬

---

## æ“ä½œè¨˜éŒ„æ ¼å¼

### YYYY-MM-DD

#### ä»»å‹™æ¨™é¡Œ
- **ä»»å‹™**: æè¿°è¦åšä»€éº¼
- **åŸ·è¡Œå‘½ä»¤**: å¯¦éš›åŸ·è¡Œçš„ AWS CLI å‘½ä»¤
- **æŸ¥è©¢çµæœ**: ç°¡è¦çµæœæ‘˜è¦
- **é‡è¦ç™¼ç¾**: éœ€è¦æ³¨æ„çš„äº‹é …
- **å¾ŒçºŒå‹•ä½œ**: å¦‚æœ‰éœ€è¦çš„å¾ŒçºŒè™•ç†

---

## å¾…è¾¦äº‹é …

- ç„¡

---

## é‡è¦å‚™è¨»

1. æ‰€æœ‰ AWS æ“ä½œä½¿ç”¨ profile: `gemini-pro_ck`
2. ä¸»è¦ç®¡ç†çš„è³‡æºï¼šRDS, S3, EC2, CloudWatch
3. æ‰€æœ‰æ“ä½œéœ€è¨˜éŒ„åœ¨æ­¤æ–‡ä»¶
4. æ–°å°è©±æ™‚å…ˆè®€å–æ­¤æ–‡ä»¶äº†è§£æ­·å²ä¸Šä¸‹æ–‡
