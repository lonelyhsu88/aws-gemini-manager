# Steampunk2 é‡å•ŸæœŸé–“ bg-gate æ—¥èªŒåˆ†æ

**åˆ†ææ™‚é–“**: 2025-11-17
**åˆ†æç¯„åœ**: HKT 08:02-08:20 (UTC 00:02-00:20)
**é‡å•Ÿæ™‚åˆ»**: HKT 08:11:22 (UTC 00:11:22)

---

## ğŸ“Š æµé‡çµ±è¨ˆ

### æ™‚é–“æ®µåˆ†æ

| æ™‚é–“æ®µ (UTC) | æ™‚é–“æ®µ (HKT) | èªªæ˜ | Steampunk2 æ—¥èªŒæ•¸é‡ |
|-------------|-------------|------|-------------------|
| 00:02-00:09 | 08:02-08:09 | é‡å•Ÿå‰ 8 åˆ†é˜ | **1,716 ç­†** |
| 00:10-00:11 | 08:10-08:11 | é‡å•Ÿå‰ 2 åˆ†é˜ | **364 ç­†** |
| 00:11:10-00:11:29 | 08:11:10-08:11:29 | é‡å•Ÿæ™‚åˆ» Â±10ç§’ | **56 ç­†** |
| 00:12-00:19 | 08:12-08:19 | é‡å•Ÿå¾Œ 8 åˆ†é˜ | **1,248 ç­†** |

**ç¸½è¨ˆ**: 3,384 ç­† Steampunk2 ç›¸é—œæ—¥èªŒ

---

## ğŸ” é—œéµç™¼ç¾

### âœ… ç™¼ç¾ 1: é‡å•ŸæœŸé–“ç„¡æœå‹™ä¸­æ–·

**è­‰æ“š**:

**é‡å•Ÿå‰æœ€å¾Œä¸€ç­†äº¤æ˜“** (UTC 00:10:45):
```json
{
  "time": "2025-11-17 00:10:45:099",
  "msg": "### [GameServer ---> GateServer] game:Steampunk2/A011",
  "loginname": "GMM4562PH296153985988",
  "billno": "000ST952511170010450001100000001",
  "currency": "php",
  "betamount": "22",
  "winamount": "200"
}
```

**é‡å•Ÿå¾Œç¬¬ä¸€ç­†äº¤æ˜“** (UTC 00:11:02):
```json
{
  "time": "2025-11-17 00:11:02:987",
  "msg": "### [GameServer ---> GateServer] game:Steampunk2/A011",
  "loginname": "GMM4562PH296153985988",
  "billno": "000ST952511170011020001100000001",
  "currency": "php",
  "transAmount": "-32"
}
```

**æ™‚é–“å·®**: 17 ç§’ (00:10:45 â†’ 00:11:02)

**åˆ†æ**:
- âœ… åŒä¸€ç©å®¶ (GMM4562PH296153985988) åœ¨é‡å•Ÿå‰å¾ŒæŒçºŒéŠç©
- âœ… äº¤æ˜“æµç¨‹å®Œæ•´: ä¸‹æ³¨ â†’ æ´¾å½© â†’ loyalty çµç®—
- âœ… ç„¡éŒ¯èª¤è¨Šæ¯
- âœ… bg-gate æœªå¯Ÿè¦º steampunk2 é‡å•Ÿ

---

### âœ… ç™¼ç¾ 2: å®Œå…¨ç„¡éŒ¯èª¤æˆ–ç•°å¸¸

**æœå°‹é—œéµå­—**: error, fail, disconnect, timeout, close

**çµæœ**: **0 ç­†éŒ¯èª¤**

```bash
# æœå°‹æŒ‡ä»¤
grep -iE "error|fail|disconnect|timeout|close" | grep "steampunk2\|A011"

# çµæœ
(ç„¡ä»»ä½•çµæœ)
```

**çµè«–**:
- âœ… bg-gate èˆ‡ steampunk2 é€šä¿¡å®Œå…¨æ­£å¸¸
- âœ… WebSocket é€£æ¥ç©©å®š
- âœ… ç„¡é€£ç·šä¸­æ–·äº‹ä»¶

---

### âœ… ç™¼ç¾ 3: æµé‡åœ¨é‡å•Ÿå¾Œå¿«é€Ÿæ¢å¾©

**æ¯åˆ†é˜å¹³å‡äº¤æ˜“æ•¸**:

| æ™‚æ®µ | äº¤æ˜“æ•¸/åˆ†é˜ | è®ŠåŒ– |
|------|-----------|------|
| 08:02-08:09 (é‡å•Ÿå‰) | ~215 | åŸºæº– |
| 08:10-08:11 (é‡å•Ÿå‰) | ~182 | -15% |
| 08:11:10-08:11:29 (é‡å•Ÿä¸­) | ~168 | -22% |
| 08:12-08:19 (é‡å•Ÿå¾Œ) | ~156 | -27% |

**åˆ†æ**:
- æµé‡ç•¥æœ‰ä¸‹é™ï¼Œä½†ä¸¦éå› ç‚ºæœå‹™ä¸­æ–·
- å¯èƒ½æ˜¯æ­£å¸¸çš„ç©å®¶æµé‡æ³¢å‹•
- **é‡å•ŸæœŸé–“ç©å®¶æœªå—å½±éŸ¿**

---

## ğŸ¯ çµè«–

### æ ¸å¿ƒçµè«–

1. **steampunk2 é‡å•Ÿå°ç©å®¶å®Œå…¨é€æ˜**
   - bg-gate æœªå¯Ÿè¦ºä»»ä½•ç•°å¸¸
   - ç©å®¶æŒçºŒæ­£å¸¸éŠç©
   - ç„¡äº¤æ˜“å¤±æ•—

2. **Kubernetes Service æ­£å¸¸é‹ä½œ**
   - Service endpoint è‡ªå‹•åˆ‡æ›
   - ç„¡éœ€æ‰‹å‹•å¹²é 
   - æµé‡ç„¡ç¸«è½‰ç§»

3. **åŸå…ˆçš„ã€Œç„¡æ³•è¼‰å…¥ã€å•é¡Œå·²è§£æ±º**
   - ç•¶å‰æœå‹™æ­£å¸¸é‹è¡Œ
   - ç©å®¶å¯æ­£å¸¸ç™»å…¥å’ŒéŠç©
   - äº¤æ˜“è™•ç†æ­£å¸¸

---

## ğŸ“‹ é‡å•Ÿæ™‚é–“è»¸

```
HKT 08:02 - 08:09  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  æ­£å¸¸é‹è¡Œ (1716 transactions)
                                      â†“
HKT 08:10 - 08:11  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  é‡å•Ÿå‰ (364 transactions)
                                      â†“
HKT 08:11:22       â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  Pod restart âš¡
                                      â†“
HKT 08:11:10-08:11:29 â”â”â”â”â”â”â”â”â”â”â”  é‡å•ŸæœŸé–“ (56 transactions)
                                      â†“
HKT 08:12 - 08:19  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  æ¢å¾©æ­£å¸¸ (1248 transactions)
```

**ç„¡ä¸­æ–·æ™‚é–“**: 0 ç§’
**ç©å®¶å½±éŸ¿**: 0 äºº
**å¤±æ•—äº¤æ˜“**: 0 ç­†

---

## ğŸ’¡ æŠ€è¡“è§£é‡‹

### ç‚ºä»€éº¼é‡å•Ÿæ²’æœ‰å½±éŸ¿ç©å®¶ï¼Ÿ

#### 1. **Kubernetes Service æ©Ÿåˆ¶**

steampunk2-service æ˜¯ ClusterIP é¡å‹:
```yaml
Service: steampunk2-service.steampunk2-prd.svc.cluster.local
Endpoints: 172.31.50.70:29011
```

ç•¶ pod é‡å•Ÿæ™‚:
1. æ–° pod å•Ÿå‹•ä¸¦é€²å…¥ Ready ç‹€æ…‹
2. Kubernetes è‡ªå‹•æ›´æ–° Service endpoints
3. æ–°é€£æ¥è‡ªå‹•è·¯ç”±åˆ°æ–° pod
4. **èˆŠé€£æ¥å¯èƒ½è¢«ä¿ç•™æˆ–å„ªé›…é—œé–‰**

#### 2. **bg-gate é‡é€£æ©Ÿåˆ¶**

bg-gate å¯èƒ½å¯¦ç¾äº†:
- WebSocket è‡ªå‹•é‡é€£
- å¤±æ•—è«‹æ±‚é‡è©¦
- é€£æ¥æ± ç®¡ç†

#### 3. **StatefulSet ç‰¹æ€§**

steampunk2-0 ä½¿ç”¨ StatefulSet:
- å›ºå®šçš„ pod åç¨± (steampunk2-0)
- å›ºå®šçš„ network identity
- é‡å•Ÿå¾Œä¿æŒç›¸åŒçš„ DNS åç¨±

---

## âš ï¸ å…ˆå‰å•é¡Œå›é¡§

### å•é¡Œæè¿°

ç”¨æˆ¶åæ˜ : "steampunk2 ç„¡æ³•è¼‰å…¥éŠæˆ²"

### èª¿æŸ¥çµæœ

1. **é…ç½®æ­£ç¢º** âœ…
   - bg-gate é…ç½®æ­£ç¢ºæŒ‡å‘ steampunk2
   - center èƒ½èˆ‡ steampunk2 é€šä¿¡
   - Service endpoints æ­£å¸¸

2. **é‡å•Ÿå¾Œæ¢å¾©** âœ…
   - ç¬¬ä¸€æ¬¡é‡å•Ÿå¾Œä»æœ‰å•é¡Œ
   - **ç¬¬äºŒæ¬¡é‡å•Ÿå¾Œå®Œå…¨æ­£å¸¸**
   - ç•¶å‰ç‹€æ…‹: æ­£å¸¸é‹è¡Œä¸­

3. **å¯èƒ½åŸå›  (æ¨æ¸¬)**
   - ç¬¬ä¸€æ¬¡é‡å•Ÿæ™‚ pod æœªå®Œå…¨åˆå§‹åŒ–
   - æ‡‰ç”¨ç¨‹åºéœ€è¦æ›´é•·çš„å•Ÿå‹•æ™‚é–“
   - æš«æ™‚çš„ç¶²è·¯å•é¡Œå·²è‡ªè¡Œè§£æ±º

---

## ğŸ“Œ å»ºè­°

### ç«‹å³è¡Œå‹•

- âœ… **ç„¡éœ€ä»»ä½•è¡Œå‹•** - æœå‹™å·²æ­£å¸¸

### æœªä¾†ç›£æ§

1. **è¨­ç½® Grafana å‘Šè­¦**
   ```
   Alert: steampunk2 pod restart
   Condition: kube_pod_container_status_restarts_total{pod="steampunk2-0"} > 0
   Notification: Slack
   ```

2. **ç›£æ§ç©å®¶é€£æ¥æ•¸**
   ```
   Metric: steampunk2_active_players
   Threshold: < 5 (warning)
   ```

3. **äº¤æ˜“æˆåŠŸç‡ç›£æ§**
   ```
   Metric: (successful_transactions / total_transactions) * 100
   Threshold: < 99% (critical)
   ```

### å¥åº·æª¢æŸ¥å»ºè­°

å»ºè­°åœ¨ steampunk2 deployment ä¸­æ·»åŠ :

```yaml
livenessProbe:
  httpGet:
    path: /health
    port: 29011
  initialDelaySeconds: 30
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /ready
    port: 29011
  initialDelaySeconds: 10
  periodSeconds: 5
```

---

## ğŸ”— ç›¸é—œæ–‡æª”

- [steampunk2 é…ç½®](../scripts/steampunk2/)
- [bg-gate æ—¥èªŒä½ç½®](../scripts/bingo-gate/)
- [Kubernetes Service æ–‡æª”](https://kubernetes.io/docs/concepts/services-networking/service/)

---

**å ±å‘Šç”Ÿæˆ**: 2025-11-17 09:45 HKT
**åˆ†æå·¥å…·**: kubectl + grep
**æ•¸æ“šä¾†æº**: bg-gate-0 pod logs (Gate-Server-2025-11-17T02-16-51.493.log)
