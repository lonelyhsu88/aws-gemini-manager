# ELS-Jump-Srv-01 æœå‹™æ¸…å–®

**å¯¦ä¾‹ ID**: i-08d21e97ba490faf6
**IP ä½å€**: 16.162.44.211 (Public) / 172.31.43.167 (Private)
**å¯¦ä¾‹é¡å‹**: t3.medium
**ç’°å¢ƒ**: DevOps
**å•Ÿå‹•æ™‚é–“**: 2025-01-07 03:34:51

---

## ğŸ¯ ä¸»è¦åŠŸèƒ½

é€™å°æ©Ÿå™¨æ˜¯ **å ¡å£˜æ©Ÿ/è·³æ¿æ©Ÿï¼ˆBastion/Jump Serverï¼‰**ï¼Œç”¨æ–¼å®‰å…¨åœ°è¨ªå•å…§ç¶²å…¶ä»–æœå‹™å™¨ã€‚

---

## ğŸ”§ é‹è¡Œçš„æœå‹™

### 1. JumpServerï¼ˆå ¡å£˜æ©Ÿç³»çµ±ï¼‰

**ç«¯å£**: 2222 (SSH), 80 (Web)

**ç”¨é€”**:
- æä¾› Web ç•Œé¢ç®¡ç†å’Œ SSH è·³è½‰åŠŸèƒ½
- ä½œç‚ºè¨ªå•å…§ç¶²æœå‹™å™¨çš„çµ±ä¸€å…¥å£
- è¨˜éŒ„å’Œå¯©è¨ˆæ‰€æœ‰è¨ªå•æ“ä½œ

**è¨ªå•ä¾†æº**:
- Port 2222:
  - VPN ç”¨æˆ¶ (18.167.236.110 - ELS-VPN DevOps)
  - OpenVPN RD (16.162.117.249 - gemini-vpn)
  - VPN å®‰å…¨çµ„ (sg-0b10c0bcef70b6d2b)

- Port 80:
  - common-nginx (172.31.7.156 - gemini-common-ngx-01)
  - VP-Whitelisting (206.190.238.160)

**æè¿°**:
```
common-nginx-to-jms  # Nginx åå‘ä»£ç†åˆ° JumpServer
vpn-to-jumpserver-cli  # VPN ç”¨æˆ¶è¨ªå•å‘½ä»¤è¡Œç•Œé¢
```

---

### 2. SSH æœå‹™

**ç«¯å£**: 22

**ç”¨é€”**: æ¨™æº– SSH è¨ªå•ï¼ˆç”¨æ–¼ç®¡ç†è·³æ¿æ©Ÿæœ¬èº«ï¼‰

**è¨ªå•ä¾†æº**:
- è‡ªå·± (172.31.43.167) - JumpServer SSH
- Deploy Server (172.31.30.21 - els-deploy-srv-01)
- OpenVPN RD (172.31.30.228 - gemini-vpn)
- DevOps OpenVPN å®‰å…¨çµ„ (sg-0eae76b13a26eccfa)
- ELS VPN å®‰å…¨çµ„ (sg-006ed8662b1029e83)

---

### 3. ç›£æ§æœå‹™

#### 3.1 Zabbix Agent

**ç«¯å£**: 10050

**ç”¨é€”**: è¢«å‹•ç›£æ§æª¢æŸ¥ï¼ˆZabbix Active Checkï¼‰

**é€£æ¥å°è±¡**:
- Zabbix Server (172.31.8.106 - els-monitor-01)

---

#### 3.2 cAdvisor (å®¹å™¨ç›£æ§)

**ç«¯å£**: 6666

**ç”¨é€”**:
- Docker å®¹å™¨è³‡æºä½¿ç”¨ç›£æ§
- æä¾› Prometheus metrics

**é€£æ¥å°è±¡**:
- Prometheus Server (172.31.8.119 - els-prometheus-n8n-01)

---

#### 3.3 Oracle ç›£æ§

**ç«¯å£**: 1521

**ç”¨é€”**: Zabbix ç›£æ§ Oracle æ•¸æ“šåº«ï¼ˆå¯èƒ½æ˜¯å®¢æˆ¶ç«¯é€£æ¥ï¼‰

**é€£æ¥å°è±¡**:
- Zabbix Server (172.31.8.106)

---

### 4. Ollama AI æœå‹™ï¼ˆå¯é¸ï¼‰

**ç«¯å£**: 11434

**ç”¨é€”**:
- æœ¬åœ° AI æ¨¡å‹æœå‹™ (Large Language Model)
- å¯èƒ½ç”¨æ–¼å…§éƒ¨ AI å·¥å…·æˆ–è‡ªå‹•åŒ–

**è¨ªå•ä¾†æº**:
- ELS-VPN (sg-006ed8662b1029e83)
- OPS-VPN (sg-097f82f335d6026b3)

**å‚™è¨»**: é€™å€‹æœå‹™è¼ƒç‰¹æ®Šï¼Œå¯èƒ½æ˜¯å¯¦é©—æ€§æˆ–ç‰¹å®šç”¨é€”

---

### 5. HTTPS æœå‹™

**ç«¯å£**: 443

**ç”¨é€”**:
- å¯èƒ½æ˜¯ JumpServer çš„ HTTPS Web ç•Œé¢
- æˆ–å…¶ä»–ç®¡ç†ç•Œé¢

**è¨ªå•ä¾†æº**:
- OpenVPN (sg-006ed8662b1029e83)

---

## ğŸ”’ å®‰å…¨çµ„é…ç½®

### 1. ELS-Jump-Srv-01-SG (sg-056d3f6368cdcbca7)
- Port 80: common-nginx è¨ªå•
- Port 2222: VPN ç”¨æˆ¶ CLI è¨ªå•

### 2. Common-Service-SG (sg-0a93fa3ab7e9e8bf3)
- Port 22: SSH ç®¡ç†è¨ªå•
- Port 443: HTTPS è¨ªå•
- Port 10050: Zabbix ç›£æ§
- Port 6666: Prometheus cAdvisor
- Port 1521: Oracle ç›£æ§
- Port 11434: Ollama AI æœå‹™

### 3. VP-Whitelisting (sg-0b0998e166f57a357)
- Port 80: ç‰¹å®š IP ç™½åå–® (206.190.238.160 - VP-Shawn)

---

## ğŸŒ ç¶²çµ¡æ¶æ§‹

```
å¤–éƒ¨ç”¨æˆ¶ (VPN)
    â†“
[16.162.44.211:2222] JumpServer CLI
    â†“
å…§ç¶²æœå‹™å™¨ (172.31.x.x)

Web ç”¨æˆ¶
    â†“
common-nginx (172.31.7.156)
    â†“
[172.31.43.167:80] JumpServer Web
    â†“
å…§ç¶²æœå‹™å™¨ç®¡ç†
```

---

## ğŸ“Š ç›£æ§æŒ‡æ¨™

### é€£æ¥çš„ç›£æ§ç³»çµ±
1. **Zabbix**: 172.31.8.106 (els-monitor-01)
   - ç³»çµ±è³‡æºç›£æ§
   - Oracle é€£æ¥ç›£æ§

2. **Prometheus**: 172.31.8.119 (els-prometheus-n8n-01)
   - å®¹å™¨è³‡æºç›£æ§ (cAdvisor)

---

## ğŸ”‘ è¨ªå•æ–¹å¼

### é€šé JumpServer Web ç•Œé¢
```
https://16.162.44.211  (éœ€è¦é€é VPN æˆ–ç™½åå–® IP)
æˆ–
http://gemini-common-ngx-01/jumpserver  (å…§ç¶²è¨ªå•)
```

### é€šé CLI (å‘½ä»¤è¡Œ)
```bash
# é€é VPN å¾Œä½¿ç”¨
ssh -p 2222 user@16.162.44.211

# æˆ–é€éå…§ç¶²
ssh -p 2222 user@172.31.43.167
```

### SSH ç›´æ¥è¨ªå•ï¼ˆç®¡ç†ç”¨ï¼‰
```bash
# éœ€è¦åœ¨å…è¨±çš„ IP ç¯„åœå…§
ssh -i hk-devops.pem ubuntu@172.31.43.167
```

---

## ğŸ“ ç›¸é—œæœå‹™å™¨

### å¯è¨ªå•çš„å…§ç¶²æœå‹™å™¨
- æ‰€æœ‰ç”Ÿç”¢ç’°å¢ƒæœå‹™å™¨ (prd-*)
- æ‰€æœ‰æ¸¬è©¦ç’°å¢ƒæœå‹™å™¨ (rel-*)
- DevOps å·¥å…·æœå‹™å™¨ (els-*)

### é—œè¯çš„æœå‹™
- **Nginx åå‘ä»£ç†**: gemini-common-ngx-01 (172.31.7.156)
- **VPN æœå‹™å™¨**: gemini-vpn (172.31.30.228)
- **Deploy æœå‹™å™¨**: els-deploy-srv-01 (172.31.30.21)
- **ç›£æ§æœå‹™å™¨**: els-monitor-01 (172.31.8.106)
- **Prometheus**: els-prometheus-n8n-01 (172.31.8.119)

---

## ğŸ› ï¸ ç¶­è­·å»ºè­°

### å®šæœŸæª¢æŸ¥é …ç›®
1. JumpServer ç‰ˆæœ¬æ›´æ–°
2. SSH é‡‘é‘°è¼ªæ›
3. è¨ªå•æ—¥èªŒå¯©è¨ˆ
4. å®‰å…¨çµ„è¦å‰‡å¯©æŸ¥
5. ç›£æ§å‘Šè­¦é…ç½®

### å®‰å…¨å»ºè­°
1. âœ… å·²å¯¦æ–½ VPN + è·³æ¿æ©Ÿé›™é‡ä¿è­·
2. âœ… æœ‰å®Œæ•´çš„ç›£æ§è¦†è“‹
3. âœ… SSH ä½¿ç”¨éæ¨™æº–ç«¯å£ (2222)
4. âš ï¸ å»ºè­°å®šæœŸå¯©è¨ˆ JumpServer è¨ªå•æ—¥èªŒ
5. âš ï¸ å»ºè­°å•Ÿç”¨ MFA (å¤šå› ç´ èªè­‰)

---

## ğŸ“ è¯çµ¡è³‡è¨Š

**è² è²¬åœ˜éšŠ**: DevOps
**ç’°å¢ƒ**: Production DevOps
**SSH Key**: hk-devops

---

## é™„éŒ„ï¼šå¿«é€Ÿå‘½ä»¤

### æª¢æŸ¥ JumpServer ç‹€æ…‹
```bash
# é€éå…§ç¶²å…¶ä»–æœå‹™å™¨
curl http://172.31.43.167:80/
curl http://172.31.43.167:2222/
```

### æŸ¥çœ‹å®‰å…¨çµ„è¦å‰‡
```bash
aws --profile gemini-pro_ck ec2 describe-security-groups \
  --group-ids sg-056d3f6368cdcbca7 sg-0a93fa3ab7e9e8bf3 sg-0b0998e166f57a357
```

### æª¢æŸ¥å¯¦ä¾‹ç‹€æ…‹
```bash
aws --profile gemini-pro_ck ec2 describe-instances \
  --instance-ids i-08d21e97ba490faf6 \
  --query 'Reservations[0].Instances[0].[State.Name,InstanceType,LaunchTime]'
```
