# å‹•æ…‹ API ç·©å­˜å¯è¡Œæ€§æ·±åº¦åˆ†æ

**åˆ†æå°è±¡**: `ds-r.geminiservice.cc` å’Œ `gameinfo-api.geminiservice.cc`
**å•é¡Œ**: é€™äº› API æ˜¯å‹•æ…‹çš„ï¼Œç·©å­˜æ˜¯å¦çœŸçš„æœ‰å¹«åŠ©ï¼Ÿ
**ç›®çš„**: æä¾›æ•¸æ“šæ”¯æŒçš„æ±ºç­–ä¾æ“š

---

## ğŸ“Š æ ¸å¿ƒå•é¡Œï¼šå‹•æ…‹ â‰  ä¸å¯ç·©å­˜

### å¸¸è¦‹èª¤è§£

```
âŒ éŒ¯èª¤èªçŸ¥:
  "API æ˜¯å‹•æ…‹çš„" â†’ "ä¸èƒ½ç·©å­˜" â†’ "ç·©å­˜æ²’ç”¨"

âœ… æ­£ç¢ºç†è§£:
  "API æ˜¯å‹•æ…‹çš„" â†’ "éœ€è¦æ™ºèƒ½ç·©å­˜ç­–ç•¥" â†’ "åˆ†æè®Šæ›´é »ç‡å’Œå½±éŸ¿"
```

### é—œéµåˆ¤æ–·æ¨™æº–

| æ¨™æº– | ä¸é©åˆç·©å­˜ | é©åˆçŸ­æœŸç·©å­˜ | é©åˆé•·æœŸç·©å­˜ |
|------|-----------|------------|------------|
| **æ•¸æ“šè®Šæ›´é »ç‡** | æ¯ç§’è®ŠåŒ– | æ¯åˆ†é˜è®ŠåŒ– | æ¯å°æ™‚/å¤©è®ŠåŒ– |
| **ç”¨æˆ¶ç‰¹å®šæ€§** | æ¯ç”¨æˆ¶ä¸åŒ | éƒ¨åˆ†ç”¨æˆ¶å…±äº« | æ‰€æœ‰ç”¨æˆ¶ç›¸åŒ |
| **å³æ™‚æ€§è¦æ±‚** | å¿…é ˆå¯¦æ™‚ | å¯æ¥å—1-5åˆ†é˜å»¶é² | å¯æ¥å—10-60åˆ†é˜å»¶é² |
| **æ•¸æ“šé¡å‹** | äº¤æ˜“ã€é¤˜é¡ | æ’è¡Œæ¦œã€çµ±è¨ˆ | é…ç½®ã€å…ƒæ•¸æ“š |

---

## ğŸ” API 1: åŸŸåé…ç½® API æ·±åº¦åˆ†æ

### API åŸºæœ¬ä¿¡æ¯

```bash
URL: https://ds-r.geminiservice.cc/domains?type=Hash
æ–¹æ³•: GET
åƒæ•¸: type (Hash, Slot, Bingo, ç­‰)
```

### å¯¦éš›éŸ¿æ‡‰æ¸¬è©¦

è®“æˆ‘å€‘å…ˆæª¢æŸ¥é€™å€‹ API çš„å¯¦éš›è¡Œç‚ºï¼š

```bash
# æ¸¬è©¦ 1: é€£çºŒ 10 æ¬¡è«‹æ±‚ï¼Œè§€å¯ŸéŸ¿æ‡‰è®ŠåŒ–
for i in {1..10}; do
  curl -s "https://ds-r.geminiservice.cc/domains?type=Hash" | md5sum
  sleep 5
done

# é æœŸçµæœåˆ†æ:
# - å¦‚æœ 10 æ¬¡ hash éƒ½ç›¸åŒ â†’ å…§å®¹å®Œå…¨éœæ…‹ âœ…
# - å¦‚æœ hash æ¯æ¬¡ä¸åŒï¼Œä½†è§£æå¾Œå…§å®¹ç›¸åŒ â†’ åŒ…å«æ™‚é–“æˆ³ âš ï¸
# - å¦‚æœå…§å®¹é »ç¹è®ŠåŒ– â†’ çœŸæ­£å‹•æ…‹ âŒ
```

### å…¸å‹éŸ¿æ‡‰æ ¼å¼æ¨æ¸¬

```json
{
  "type": "Hash",
  "domains": [
    "hash1.geminiservice.cc",
    "hash2.geminiservice.cc"
  ],
  "version": "1.0.0",
  "timestamp": "2025-10-31T10:00:00Z",  // âš ï¸ é€™å€‹å­—æ®µæœƒå°è‡´éŸ¿æ‡‰æ¯æ¬¡ä¸åŒ
  "ttl": 300
}
```

### ç·©å­˜åƒ¹å€¼åˆ†æ

**å ´æ™¯ A: éŸ¿æ‡‰åŒ…å«å‹•æ…‹æ™‚é–“æˆ³**

```javascript
// ç•¶å‰å•é¡Œ
æ¯æ¬¡è«‹æ±‚è¿”å›:
{
  "domains": [...],        // â† å¯¦éš›æœ‰ç”¨çš„æ•¸æ“šï¼ˆä¸è®Šï¼‰
  "timestamp": "10:00:01"  // â† å‹•æ…‹æ™‚é–“æˆ³ï¼ˆç„¡æ„ç¾©ï¼‰
}

æ¯æ¬¡è«‹æ±‚è¿”å›:
{
  "domains": [...],        // â† ç›¸åŒ
  "timestamp": "10:00:02"  // â† ä¸åŒï¼ˆå°è‡´ç„¡æ³•ç·©å­˜ï¼‰
}
```

**å½±éŸ¿**:
- å¯¦éš›æœ‰ç”¨æ•¸æ“šï¼ˆdomainsï¼‰å®Œå…¨ç›¸åŒ
- ä½†å› ç‚ºæ™‚é–“æˆ³ä¸åŒï¼ŒCDN èªç‚ºæ˜¯æ–°å…§å®¹
- **çµæœ**: ç·©å­˜ç„¡æ•ˆï¼Œæ¯æ¬¡éƒ½å›æº

**è§£æ±ºæ–¹æ¡ˆ**:

1ï¸âƒ£ **æœ€ä½³æ–¹æ¡ˆ**: æºæœå‹™å™¨ç§»é™¤ç„¡æ„ç¾©çš„æ™‚é–“æˆ³
```javascript
// ä¿®æ”¹å‰
{
  "domains": [...],
  "timestamp": "2025-10-31T10:00:01Z"  // ç§»é™¤é€™å€‹
}

// ä¿®æ”¹å¾Œ
{
  "domains": [...],
  "version": "1.0.0"  // åªåœ¨çœŸæ­£æ›´æ–°æ™‚è®ŠåŒ–
}
```

2ï¸âƒ£ **Akamai æ–¹æ¡ˆ**: æ¨™æº–åŒ–éŸ¿æ‡‰ï¼ˆç§»é™¤å‹•æ…‹å­—æ®µï¼‰
```json
{
  "name": "Normalize API Response",
  "behaviors": [
    {
      "name": "modifyOutgoingResponseHeader",
      "options": {
        "action": "MODIFY",
        "customHeaderName": "Edge-Control",
        "newHeaderValue": "cache-maxage=5m, downstream-ttl=5m"
      }
    }
  ]
}
```

3ï¸âƒ£ **å®¢æˆ¶ç«¯æ–¹æ¡ˆ**: ä½¿ç”¨ ETag
```bash
# ç¬¬ä¸€æ¬¡è«‹æ±‚
curl -I "https://ds-r.geminiservice.cc/domains?type=Hash"
# ETag: "abc123"

# ç¬¬äºŒæ¬¡è«‹æ±‚ï¼ˆå¸¶ If-None-Matchï¼‰
curl -H "If-None-Match: abc123" -I "https://ds-r.geminiservice.cc/domains?type=Hash"
# 304 Not Modified (ä¸å‚³è¼¸æ•¸æ“šï¼Œç¯€çœå¸¶å¯¬)
```

---

### å¯¦éš›æ¸¬è©¦ï¼šé©—è­‰ç·©å­˜åƒ¹å€¼

```bash
# æ¸¬è©¦è¨ˆåŠƒ
1. å¾å­Ÿè²· EC2 æ¸¬è©¦ç•¶å‰ç‹€æ…‹ï¼ˆç„¡ç·©å­˜ï¼‰
2. å•Ÿç”¨ CDN ç·©å­˜
3. å°æ¯”æ€§èƒ½å·®ç•°
```

**æ¸¬è©¦è…³æœ¬**:

```bash
#!/bin/bash
# test-domains-api-cache-value.sh

API_URL="https://ds-r.geminiservice.cc/domains?type=Hash"

echo "=== æ¸¬è©¦ 1: ç•¶å‰ç‹€æ…‹ï¼ˆç„¡ç·©å­˜ï¼‰==="
for i in {1..10}; do
  time_taken=$(curl -w "%{time_total}" -o /dev/null -s "$API_URL")
  echo "ç¬¬ $i æ¬¡: ${time_taken}s"
  sleep 1
done

echo ""
echo "=== æ¸¬è©¦ 2: æª¢æŸ¥éŸ¿æ‡‰æ˜¯å¦çœŸçš„åœ¨è®ŠåŒ– ==="
curl -s "$API_URL" > /tmp/response1.json
sleep 5
curl -s "$API_URL" > /tmp/response2.json
sleep 5
curl -s "$API_URL" > /tmp/response3.json

echo "éŸ¿æ‡‰ 1 vs 2:"
diff /tmp/response1.json /tmp/response2.json
echo "éŸ¿æ‡‰ 2 vs 3:"
diff /tmp/response2.json /tmp/response3.json

echo ""
echo "=== æ¸¬è©¦ 3: åˆ†æéŸ¿æ‡‰å¤§å° ==="
response_size=$(curl -s "$API_URL" | wc -c)
echo "éŸ¿æ‡‰å¤§å°: ${response_size} bytes"

# è¨ˆç®—ç·©å­˜åƒ¹å€¼
echo ""
echo "=== ç·©å­˜åƒ¹å€¼è¨ˆç®— ==="
echo "å‡è¨­ TTL = 5 åˆ†é˜ï¼Œæ¯ç§’ 10 å€‹è«‹æ±‚ï¼š"
echo "  - ç„¡ç·©å­˜: 10 req/s Ã— 300s = 3000 æ¬¡å›æº"
echo "  - æœ‰ç·©å­˜: 1 æ¬¡å›æº + 2999 æ¬¡ CDN å‘½ä¸­"
echo "  - ç¯€çœå›æº: 99.97%"
echo "  - ç¯€çœå¸¶å¯¬: $(( response_size * 2999 )) bytes ($(( response_size * 2999 / 1024 / 1024 )) MB)"
```

---

## ğŸ® API 2: éŠæˆ²ä¿¡æ¯ API æ·±åº¦åˆ†æ

### API åŸºæœ¬ä¿¡æ¯

```bash
URL: https://gameinfo-api.geminiservice.cc/api/v1/operator/url/gameInfo
åƒæ•¸: productId=ELS&gameType=StandAlonePlinko
```

### é—œéµå•é¡Œï¼šæ˜¯å¦åŒ…å«ç”¨æˆ¶ç‰¹å®šæ•¸æ“šï¼Ÿ

é€™æ˜¯æ±ºå®šç·©å­˜ç­–ç•¥çš„æœ€é—œéµå› ç´ ï¼š

```bash
# æ¸¬è©¦æ–¹æ³•ï¼šç”¨å…©å€‹ä¸åŒçš„ Token/Session è«‹æ±‚
curl -H "Cookie: session=USER_A" \
  "https://gameinfo-api.geminiservice.cc/api/v1/operator/url/gameInfo?productId=ELS&gameType=StandAlonePlinko" \
  > response_user_a.json

curl -H "Cookie: session=USER_B" \
  "https://gameinfo-api.geminiservice.cc/api/v1/operator/url/gameInfo?productId=ELS&gameType=StandAlonePlinko" \
  > response_user_b.json

diff response_user_a.json response_user_b.json
```

**çµæœåˆ¤æ–·**:

| Diff çµæœ | å«ç¾© | ç·©å­˜ç­–ç•¥ |
|----------|------|---------|
| å®Œå…¨ç›¸åŒ | ç´”é…ç½® APIï¼Œä¸å«ç”¨æˆ¶æ•¸æ“š | âœ… å…¬å…±ç·©å­˜ 5-10 åˆ†é˜ |
| åªæœ‰ timestamp ä¸åŒ | é…ç½®ç›¸åŒï¼Œåªæ˜¯å‹•æ…‹æ™‚é–“æˆ³ | âœ… å…¬å…±ç·©å­˜ï¼ˆéœ€æ¨™æº–åŒ–ï¼‰ |
| Token/URL ä¸åŒ | åŒ…å«ç”¨æˆ¶æœƒè©±ä»¤ç‰Œ | âš ï¸ å¯ç·©å­˜ï¼ˆToken å‹•æ…‹ç”Ÿæˆï¼‰ |
| userId/balance ä¸åŒ | åŒ…å«ç”¨æˆ¶ç‰¹å®šæ•¸æ“š | âŒ ç§æœ‰ç·©å­˜æˆ–ä¸ç·©å­˜ |

---

### å ´æ™¯åˆ†æï¼šå››ç¨®å¯èƒ½æƒ…æ³

#### æƒ…æ³ 1: ç´”é…ç½® APIï¼ˆæœ€ç†æƒ³ï¼‰

**éŸ¿æ‡‰ç¯„ä¾‹**:
```json
{
  "gameId": "StandAlonePlinko",
  "productId": "ELS",
  "gameUrl": "https://cdn.example.com/plinko/v2.1.5/index.html",
  "version": "2.1.5",
  "config": {
    "maxBet": 1000,
    "minBet": 10,
    "rtpRange": [94, 97]
  }
}
```

**ç·©å­˜åƒ¹å€¼**: â­â­â­â­â­ (5/5)

| æŒ‡æ¨™ | ç„¡ç·©å­˜ | æœ‰ç·©å­˜ | æ”¹å–„ |
|------|--------|--------|------|
| å­Ÿè²·ç”¨æˆ¶ API å»¶é² | 368ms | 1ms | **99.7%** |
| æ¯é åŠ è¼‰æ™‚é–“ | 28s | 12s | **57%** |
| æºæœå‹™å™¨è² è¼‰ | 100% | 1% | **99%** |
| å¸¶å¯¬æˆæœ¬ | 100% | 1% | **99%** |

**æ¨è–¦é…ç½®**:
```http
Cache-Control: public, max-age=600, s-maxage=1800, stale-while-revalidate=60
```

---

#### æƒ…æ³ 2: åŒ…å«å‹•æ…‹ Tokenï¼ˆæ¬¡ç†æƒ³ï¼‰

**éŸ¿æ‡‰ç¯„ä¾‹**:
```json
{
  "gameId": "StandAlonePlinko",
  "gameUrl": "https://game.example.com/play?token=abc123xyz",  // â† æ¯æ¬¡ä¸åŒ
  "version": "2.1.5"
}
```

**åˆ†æ**:
- Token æ˜¯å‹•æ…‹ç”Ÿæˆçš„æœƒè©±ä»¤ç‰Œ
- ä½†ç›¸åŒéŠæˆ²é¡å‹ï¼ŒToken æ ¼å¼ç›¸åŒ
- **é—œéµ**: Token æ˜¯å¦å¯ä»¥å®¢æˆ¶ç«¯ç”Ÿæˆï¼Ÿ

**è§£æ±ºæ–¹æ¡ˆ A**: æ‹†åˆ† APIï¼ˆæ¨è–¦ï¼‰
```javascript
// API 1: ç²å–éŠæˆ²é…ç½®ï¼ˆå¯ç·©å­˜ï¼‰
GET /api/v1/game/config?gameType=Plinko
Response: {
  "gameUrl": "https://game.example.com/play",  // ä¸å« token
  "version": "2.1.5"
}

// API 2: ç²å–éŠæˆ² Tokenï¼ˆä¸ç·©å­˜ï¼‰
GET /api/v1/game/token?gameType=Plinko
Response: {
  "token": "abc123xyz",
  "expiresIn": 3600
}

// å®¢æˆ¶ç«¯åˆä½µ
const config = await fetch('/api/v1/game/config?gameType=Plinko');  // CDN ç·©å­˜
const token = await fetch('/api/v1/game/token?gameType=Plinko');   // å›æº
const gameUrl = `${config.gameUrl}?token=${token.token}`;
```

**ç·©å­˜åƒ¹å€¼**: â­â­â­â­ (4/5)

| æŒ‡æ¨™ | æ‹†åˆ†å‰ | æ‹†åˆ†å¾Œ | æ”¹å–„ |
|------|--------|--------|------|
| API è«‹æ±‚å»¶é² | 368ms | 1ms (config) + 368ms (token) | ç¸½è¨ˆ 369ms |
| æ•¸æ“šå‚³è¼¸ | 100% | 10% (token å¾ˆå°) | **90%** |
| ç·©å­˜å‘½ä¸­ç‡ | 0% | 99% (config) | **99%** |

---

#### æƒ…æ³ 3: åŒ…å«ç”¨æˆ¶é¤˜é¡ï¼ˆä¸ç†æƒ³ï¼‰

**éŸ¿æ‡‰ç¯„ä¾‹**:
```json
{
  "gameId": "StandAlonePlinko",
  "gameUrl": "https://game.example.com/play",
  "userBalance": 5000,     // â† ç”¨æˆ¶ç‰¹å®š
  "userId": "user123"      // â† ç”¨æˆ¶ç‰¹å®š
}
```

**åˆ†æ**:
- **åš´é‡å•é¡Œ**: ä¸åŒç”¨æˆ¶æœƒçœ‹åˆ°ä¸åŒéŸ¿æ‡‰
- **å®‰å…¨é¢¨éšª**: å¦‚æœèª¤ç·©å­˜ç‚º publicï¼Œç”¨æˆ¶ A æœƒçœ‹åˆ°ç”¨æˆ¶ B çš„é¤˜é¡
- **éš±ç§å•é¡Œ**: é•åæ•¸æ“šä¿è­·åŸå‰‡

**ç·©å­˜ç­–ç•¥**:

```http
# CDN å±¤å®Œå…¨ä¸ç·©å­˜
Cache-Control: no-store

# æˆ–åƒ…ç€è¦½å™¨ç§æœ‰ç·©å­˜ï¼ˆ60ç§’ï¼‰
Cache-Control: private, max-age=60, must-revalidate
Vary: Cookie, Authorization
```

**ç·©å­˜åƒ¹å€¼**: â­ (1/5)

| æŒ‡æ¨™ | æ”¹å–„ | èªªæ˜ |
|------|------|------|
| CDN ç·©å­˜ | 0% | ä¸èƒ½ç·©å­˜ |
| ç€è¦½å™¨ç·©å­˜ | å°å¹… | åƒ…åŒä¸€ç”¨æˆ¶é‡è¤‡è¨ªå•æ™‚æœ‰æ•ˆ |

**å»ºè­°**: å¿…é ˆæ‹†åˆ† API
```javascript
// é…ç½® APIï¼ˆå…¬å…±ç·©å­˜ï¼‰
GET /api/v1/game/config?gameType=Plinko
â†’ è¿”å›éŠæˆ²é…ç½®ï¼ˆç„¡ç”¨æˆ¶æ•¸æ“šï¼‰

// ç”¨æˆ¶ç‹€æ…‹ APIï¼ˆä¸ç·©å­˜ï¼‰
GET /api/v1/user/status
â†’ è¿”å›ç”¨æˆ¶é¤˜é¡ã€ç­‰ç´šç­‰
```

---

#### æƒ…æ³ 4: é »ç¹è®ŠåŒ–çš„é…ç½®ï¼ˆå‹•æ…‹æ´»å‹•ï¼‰

**å ´æ™¯**: éŠæˆ²é…ç½®æ ¹æ“šæ´»å‹•æ™‚é–“å‹•æ…‹èª¿æ•´

```json
{
  "gameId": "StandAlonePlinko",
  "gameUrl": "https://game.example.com/play",
  "currentEvent": {
    "name": "Happy Hour",
    "multiplier": 2.0,
    "endsAt": "2025-10-31T18:00:00Z"
  },
  "maxBet": 2000  // â† æ´»å‹•æœŸé–“ç¿»å€
}
```

**åˆ†æ**:
- é…ç½®æ ¹æ“šæ™‚é–“è®ŠåŒ–
- ä½†è®ŠåŒ–æ˜¯å¯é æ¸¬çš„ï¼ˆæ´»å‹•æ™‚é–“è¡¨ï¼‰

**ç·©å­˜ç­–ç•¥**: çŸ­ TTL + æ¢ä»¶è«‹æ±‚

```http
Cache-Control: public, max-age=60, must-revalidate
ETag: "event-happy-hour-20251031"
```

**ç·©å­˜åƒ¹å€¼**: â­â­â­ (3/5)

| æŒ‡æ¨™ | ç„¡ç·©å­˜ | 1åˆ†é˜ç·©å­˜ | æ”¹å–„ |
|------|--------|----------|------|
| å›æºé »ç‡ | æ¯æ¬¡ | æ¯60ç§’ | **98%** (å‡è¨­æ¯ç§’10è«‹æ±‚) |
| å»¶é² | 368ms | 1ms (59æ¬¡) + 368ms (1æ¬¡) | **å¹³å‡ 7ms** |

---

## ğŸ’° æˆæœ¬æ•ˆç›Šåˆ†æ

### å‡è¨­ï¼šå­Ÿè²·åœ°å€ç”¨æˆ¶è¨ªå•

**ç•¶å‰ç‹€æ…‹ï¼ˆç„¡ç·©å­˜ï¼‰**:

```
ç”¨æˆ¶è¦æ¨¡: 1000 DAU (æ¯æ—¥æ´»èºç”¨æˆ¶)
æ¯ç”¨æˆ¶è«‹æ±‚: 10 æ¬¡ API èª¿ç”¨
ç¸½è«‹æ±‚é‡: 10,000 æ¬¡/å¤©

æ¯æ¬¡è«‹æ±‚æˆæœ¬:
  - API å»¶é²: 0.35s (å­Ÿè²·â†’é¦™æ¸¯)
  - æ•¸æ“šå‚³è¼¸: 2 KB
  - æºæœå‹™å™¨è™•ç†: 1 æ¬¡æ•¸æ“šåº«æŸ¥è©¢

æ¯æ—¥æˆæœ¬:
  - ç”¨æˆ¶ç­‰å¾…æ™‚é–“: 10,000 Ã— 0.35s = 3,500 ç§’ = 58 åˆ†é˜
  - æ•¸æ“šå‚³è¼¸: 10,000 Ã— 2 KB = 20 MB
  - æ•¸æ“šåº«æŸ¥è©¢: 10,000 æ¬¡
  - è·¨å€åŸŸç¶²è·¯è²»ç”¨: 20 MB Ã— $0.12/GB = $0.0024
```

**å•Ÿç”¨ç·©å­˜å¾Œï¼ˆTTL = 5 åˆ†é˜ï¼‰**:

```
ç·©å­˜å‘½ä¸­ç‡è¨ˆç®—:
  - 5 åˆ†é˜ = 300 ç§’
  - å¹³å‡è«‹æ±‚é–“éš”: 86,400s / 10,000 æ¬¡ = 8.64s
  - ç·©å­˜æœŸå…§è«‹æ±‚æ•¸: 300s / 8.64s â‰ˆ 35 æ¬¡
  - ç·©å­˜å‘½ä¸­ç‡: 34/35 = 97.1%

å¯¦éš›å›æºæ¬¡æ•¸: 10,000 Ã— 2.9% = 290 æ¬¡/å¤©

æ¯æ—¥æˆæœ¬:
  - CDN å‘½ä¸­ (9,710 æ¬¡): 9,710 Ã— 0.001s = 9.7 ç§’
  - å›æº (290 æ¬¡): 290 Ã— 0.35s = 101.5 ç§’
  - ç¸½ç­‰å¾…æ™‚é–“: 111.2 ç§’ âœ… vs 3,500 ç§’
  - æ•¸æ“šå‚³è¼¸: 290 Ã— 2 KB = 0.58 MB âœ… vs 20 MB
  - æ•¸æ“šåº«æŸ¥è©¢: 290 æ¬¡ âœ… vs 10,000 æ¬¡
  - ç¶²è·¯è²»ç”¨: $0.00007 âœ… vs $0.0024

ç¯€çœ:
  - ç”¨æˆ¶ç­‰å¾…æ™‚é–“: 96.8% â­â­â­â­â­
  - æ•¸æ“šå‚³è¼¸: 97.1% â­â­â­â­â­
  - æ•¸æ“šåº«è² è¼‰: 97.1% â­â­â­â­â­
  - æˆæœ¬: 97.1% â­â­â­â­â­
```

### ROI è¨ˆç®—

**å¯¦æ–½æˆæœ¬**:
```
ä¸€æ¬¡æ€§æˆæœ¬:
  - Akamai é…ç½®ä¿®æ”¹: 2 å°æ™‚ Ã— $100/h = $200
  - æ¸¬è©¦é©—è­‰: 4 å°æ™‚ Ã— $100/h = $400
  - ç¸½è¨ˆ: $600

æ¯æœˆé‹ç‡Ÿæˆæœ¬:
  - Akamai CDN å¢é‡: $0 (å·²æœ‰ CDNï¼Œåªæ˜¯å•Ÿç”¨ç·©å­˜)
  - ç›£æ§æˆæœ¬: $10/æœˆ
```

**æ”¶ç›Š**:
```
æ€§èƒ½æ”¹å–„:
  - å­Ÿè²·ç”¨æˆ¶é«”é©—: 28s â†’ 12s (åŠ è¼‰æ™‚é–“)
  - ç”¨æˆ¶æ»¿æ„åº¦æå‡: ä¼°è¨ˆ 15-20%
  - è½‰åŒ–ç‡æå‡: ä¼°è¨ˆ 5-10%

æˆæœ¬ç¯€çœ:
  - æºæœå‹™å™¨è² è¼‰: -97%
  - æ•¸æ“šåº«æŸ¥è©¢: -97%
  - è·¨å€åŸŸå¸¶å¯¬: -97%
  - æœˆç¯€çœ: $50-100 (å°å‹ç³»çµ±)

ROI:
  - å›æœ¬é€±æœŸ: 6-12 å€‹æœˆ
  - é•·æœŸæ”¶ç›Š: æŒçºŒæ€§èƒ½æ”¹å–„
```

---

## ğŸ§ª A/B æ¸¬è©¦æ–¹æ¡ˆ

### æ¸¬è©¦è¨­è¨ˆ

```
ç›®çš„: é©—è­‰ API ç·©å­˜å°å¯¦éš›æ¥­å‹™æŒ‡æ¨™çš„å½±éŸ¿
æ™‚é–“: 2 é€±
ç”¨æˆ¶åˆ†çµ„:
  - A çµ„ (50%): ç„¡ç·©å­˜ï¼ˆç•¶å‰ç‹€æ…‹ï¼‰
  - B çµ„ (50%): å•Ÿç”¨ç·©å­˜ï¼ˆTTL = 5 åˆ†é˜ï¼‰
```

### Akamai é…ç½®

```json
{
  "name": "API Cache A/B Test",
  "criteria": [
    {
      "name": "bucket",
      "options": {
        "percentage": 50
      }
    }
  ],
  "behaviors": [
    {
      "name": "caching",
      "options": {
        "behavior": "MAX_AGE",
        "ttl": "5m"
      }
    },
    {
      "name": "modifyOutgoingResponseHeader",
      "options": {
        "action": "ADD",
        "customHeaderName": "X-AB-Group",
        "newHeaderValue": "cache-enabled"
      }
    }
  ]
}
```

### ç›£æ§æŒ‡æ¨™

| æŒ‡æ¨™é¡åˆ¥ | æŒ‡æ¨™åç¨± | A çµ„ï¼ˆç„¡ç·©å­˜ï¼‰ | B çµ„ï¼ˆæœ‰ç·©å­˜ï¼‰ | ç›®æ¨™æ”¹å–„ |
|----------|----------|---------------|---------------|----------|
| **æ€§èƒ½** | API å¹³å‡å»¶é² | 350ms | <10ms | >95% |
| **æ€§èƒ½** | é é¢åŠ è¼‰æ™‚é–“ | 28s | <15s | >45% |
| **æ¥­å‹™** | éŠæˆ²å•Ÿå‹•æˆåŠŸç‡ | åŸºç·š | æ¯”è¼ƒ | +5% |
| **æ¥­å‹™** | ç”¨æˆ¶ç•™å­˜ç‡ | åŸºç·š | æ¯”è¼ƒ | +3% |
| **æ¥­å‹™** | æ¯ç”¨æˆ¶éŠæˆ²æ¬¡æ•¸ | åŸºç·š | æ¯”è¼ƒ | +10% |
| **æŠ€è¡“** | CDN ç·©å­˜å‘½ä¸­ç‡ | 0% | >95% | - |
| **æŠ€è¡“** | æºæœå‹™å™¨ QPS | åŸºç·š | æ¯”è¼ƒ | -95% |
| **æˆæœ¬** | æ•¸æ“šå‚³è¼¸é‡ | åŸºç·š | æ¯”è¼ƒ | -95% |

### æ•¸æ“šæ”¶é›†

```javascript
// å‰ç«¯åŸ‹é»
window.performance.mark('api-start');
fetch('https://gameinfo-api.geminiservice.cc/api/v1/operator/url/gameInfo?productId=ELS&gameType=Plinko')
  .then(response => {
    window.performance.mark('api-end');
    window.performance.measure('api-duration', 'api-start', 'api-end');

    const apiTime = performance.getEntriesByName('api-duration')[0].duration;
    const cacheStatus = response.headers.get('X-Cache');
    const abGroup = response.headers.get('X-AB-Group');

    // ç™¼é€åˆ°åˆ†æå¹³å°
    analytics.track('API Performance', {
      duration: apiTime,
      cacheStatus: cacheStatus,
      abGroup: abGroup,
      endpoint: 'gameInfo'
    });
  });
```

---

## âš ï¸ é¢¨éšªè©•ä¼°èˆ‡ç·©è§£

### é¢¨éšª 1: æ•¸æ“šä¸ä¸€è‡´

**é¢¨éšªæè¿°**:
- æºæœå‹™å™¨æ›´æ–°é…ç½®ï¼ˆä¾‹å¦‚ï¼šç·Šæ€¥ç¶­è­·ï¼Œé—œé–‰æŸå€‹éŠæˆ²ï¼‰
- CDN ä»è¿”å›èˆŠç·©å­˜ï¼ˆéŠæˆ²ä»ç„¶å¯è¨ªå•ï¼‰
- ç”¨æˆ¶è¨ªå•åˆ°å·²é—œé–‰çš„éŠæˆ²

**å½±éŸ¿ç­‰ç´š**: ğŸ”´ é«˜

**ç™¼ç”Ÿæ¦‚ç‡**: ä¸­

**ç·©è§£æ–¹æ¡ˆ**:

1ï¸âƒ£ **ç·©å­˜å¤±æ•ˆ API**
```bash
# éƒ¨ç½²æ–°ç‰ˆæœ¬æ™‚ï¼Œè‡ªå‹•æ¸…é™¤ CDN ç·©å­˜
curl -X POST https://api.akamai.com/ccu/v3/invalidate/url \
  -H "Authorization: Bearer $AKAMAI_TOKEN" \
  -d '{
    "objects": [
      "https://ds-r.geminiservice.cc/domains?type=Hash",
      "https://gameinfo-api.geminiservice.cc/api/v1/operator/url/gameInfo?productId=ELS&gameType=*"
    ]
  }'
```

2ï¸âƒ£ **ç‰ˆæœ¬åŒ– API**
```
ä¸ä½¿ç”¨: /api/v1/operator/url/gameInfo?gameType=Plinko
æ”¹ç”¨: /api/v1/operator/url/gameInfo?gameType=Plinko&v=20251031-1430

æ¯æ¬¡éƒ¨ç½²è‡ªå‹•æ›´æ–°ç‰ˆæœ¬è™Ÿ â†’ è‡ªå‹•å¤±æ•ˆèˆŠç·©å­˜
```

3ï¸âƒ£ **çŸ­ TTL + Stale-while-revalidate**
```http
Cache-Control: public, max-age=120, stale-while-revalidate=60

# æœ€å£æƒ…æ³ä¸‹ï¼Œæ•¸æ“šå»¶é² 2-3 åˆ†é˜æ›´æ–°
# ä½†ç”¨æˆ¶é«”é©—ä»ç„¶æ¥µå¿«
```

---

### é¢¨éšª 2: ç·©å­˜ç©¿é€

**é¢¨éšªæè¿°**:
- æƒ¡æ„ç”¨æˆ¶é »ç¹è«‹æ±‚ä¸å­˜åœ¨çš„éŠæˆ²é¡å‹
- æ¯æ¬¡éƒ½ MISSï¼Œç›´æ¥æ‰“åˆ°æºæœå‹™å™¨
- å¯èƒ½å°è‡´ DDoS

**å½±éŸ¿ç­‰ç´š**: ğŸŸ¡ ä¸­

**ç™¼ç”Ÿæ¦‚ç‡**: ä½

**ç·©è§£æ–¹æ¡ˆ**:

1ï¸âƒ£ **ç·©å­˜ 404 éŸ¿æ‡‰**
```json
{
  "name": "Cache 404 Responses",
  "criteria": [{
    "name": "responseStatus",
    "options": {
      "matchOperator": "IS",
      "value": "404"
    }
  }],
  "behaviors": [{
    "name": "caching",
    "options": {
      "behavior": "MAX_AGE",
      "ttl": "30s"
    }
  }]
}
```

2ï¸âƒ£ **åƒæ•¸ç™½åå–®**
```json
{
  "name": "Validate Game Type",
  "criteria": [{
    "name": "queryStringParameter",
    "options": {
      "parameterName": "gameType",
      "matchOperator": "IS_NOT_ONE_OF",
      "values": ["Plinko", "Crash", "Dice", "Mines", ...]
    }
  }],
  "behaviors": [{
    "name": "failAction",
    "options": {
      "statusCode": 400
    }
  }]
}
```

---

### é¢¨éšª 3: ç”¨æˆ¶æ•¸æ“šæ´©éœ²

**é¢¨éšªæè¿°**:
- èª¤å°‡åŒ…å«ç”¨æˆ¶æ•¸æ“šçš„éŸ¿æ‡‰ç·©å­˜ç‚º public
- ç”¨æˆ¶ A çœ‹åˆ°ç”¨æˆ¶ B çš„é¤˜é¡

**å½±éŸ¿ç­‰ç´š**: ğŸ”´ æ¥µé«˜

**ç™¼ç”Ÿæ¦‚ç‡**: ä½ï¼ˆä½†å¾Œæœåš´é‡ï¼‰

**ç·©è§£æ–¹æ¡ˆ**:

1ï¸âƒ£ **å¼·åˆ¶æª¢æŸ¥ Authorization é ­**
```json
{
  "name": "Never Cache Authenticated Requests",
  "criteria": [{
    "name": "requestHeader",
    "options": {
      "matchOperator": "EXISTS",
      "headerName": "Authorization"
    }
  }],
  "behaviors": [{
    "name": "caching",
    "options": {
      "behavior": "NO_STORE"
    }
  }]
}
```

2ï¸âƒ£ **æ·»åŠ å®‰å…¨é ­æª¢æŸ¥**
```json
{
  "name": "Add Vary Header",
  "behaviors": [{
    "name": "modifyOutgoingResponseHeader",
    "options": {
      "action": "ADD",
      "standardAddHeaderName": "VARY",
      "newHeaderValue": "Authorization, Cookie, X-User-Id"
    }
  }]
}
```

3ï¸âƒ£ **æ¸¬è©¦æµç¨‹**
```bash
# æ¯æ¬¡é…ç½®è®Šæ›´å¾Œï¼Œå¿…é ˆåŸ·è¡Œ
./test-cache-safety.sh

# è…³æœ¬å…§å®¹
# 1. ç”¨å…©å€‹ä¸åŒç”¨æˆ¶è«‹æ±‚åŒä¸€ API
# 2. é©—è­‰éŸ¿æ‡‰æ˜¯å¦ç›¸åŒ
# 3. å¦‚æœç›¸åŒä¸”åŒ…å«ç”¨æˆ¶æ•¸æ“š â†’ å ±è­¦
```

---

## ğŸ“‹ æ±ºç­–æª¢æŸ¥æ¸…å–®

åœ¨å•Ÿç”¨ç·©å­˜å‰ï¼Œè«‹ç¢ºèªä»¥ä¸‹äº‹é …ï¼š

### âœ… å¿…é ˆç¢ºèªçš„äº‹é …

- [ ] **API éŸ¿æ‡‰ä¸åŒ…å«ç”¨æˆ¶ç‰¹å®šæ•¸æ“š**ï¼ˆuserId, balance, tokenï¼‰
- [ ] **ç›¸åŒåƒæ•¸å°æ‰€æœ‰ç”¨æˆ¶è¿”å›ç›¸åŒå…§å®¹**
- [ ] **æ•¸æ“šæ›´æ–°é »ç‡ä½æ–¼ TTL**ï¼ˆä¾‹å¦‚ï¼š1 å°æ™‚æ›´æ–°ä¸€æ¬¡ï¼ŒTTL = 5 åˆ†é˜ï¼‰
- [ ] **æ¥­å‹™å¯æ¥å— TTL æ™‚é•·çš„æ•¸æ“šå»¶é²**
- [ ] **å·²é…ç½®ç·©å­˜å¤±æ•ˆæ©Ÿåˆ¶**ï¼ˆæ‰‹å‹•æ¸…é™¤æˆ–ç‰ˆæœ¬åŒ–ï¼‰
- [ ] **å·²è¨­ç½® Vary é ­**ï¼ˆå¦‚æœéŸ¿æ‡‰ä¾è³´æŸäº›è«‹æ±‚é ­ï¼‰
- [ ] **å·²æ¸¬è©¦ä¸åŒåƒæ•¸ç”Ÿæˆä¸åŒç·©å­˜**
- [ ] **å·²é…ç½® Authorization é ­æª¢æŸ¥**ï¼ˆå¦‚æœæ¶‰åŠç”¨æˆ¶èªè­‰ï¼‰

### âš ï¸ æ¨è–¦ä½†éå¿…é ˆ

- [ ] é…ç½®ç›£æ§å‘Šè­¦ï¼ˆç·©å­˜å‘½ä¸­ç‡ < 90%ï¼‰
- [ ] è¨­ç½® stale-while-revalidateï¼ˆæ”¹å–„ç”¨æˆ¶é«”é©—ï¼‰
- [ ] é…ç½® stale-if-errorï¼ˆæé«˜å¯ç”¨æ€§ï¼‰
- [ ] å¯¦æ–½ A/B æ¸¬è©¦ï¼ˆé©—è­‰æ¥­å‹™å½±éŸ¿ï¼‰
- [ ] æº–å‚™ç·Šæ€¥å›æ»¾æ–¹æ¡ˆ

---

## ğŸ¯ æ¨è–¦è¡Œå‹•æ–¹æ¡ˆ

### éšæ®µ 1: é©—è­‰éšæ®µï¼ˆ1-2 å¤©ï¼‰

1. **æª¢æŸ¥ API éŸ¿æ‡‰å…§å®¹**
```bash
# åœ¨å­Ÿè²· EC2 åŸ·è¡Œ
ssh ubuntu@MUMBAI_IP

# æ¸¬è©¦éŸ¿æ‡‰ä¸€è‡´æ€§
./test-api-consistency.sh

# æª¢æŸ¥æ˜¯å¦åŒ…å«ç”¨æˆ¶æ•¸æ“š
./check-user-data-leakage.sh
```

2. **åˆ†æçµæœ**
   - å¦‚æœéŸ¿æ‡‰å®Œå…¨ç›¸åŒ â†’ âœ… é€²å…¥éšæ®µ 2
   - å¦‚æœåªæœ‰æ™‚é–“æˆ³ä¸åŒ â†’ âš ï¸ éœ€è¦æºæœå‹™å™¨é…åˆç§»é™¤
   - å¦‚æœåŒ…å«ç”¨æˆ¶æ•¸æ“š â†’ âŒ å¿…é ˆæ‹†åˆ† API

### éšæ®µ 2: å°è¦æ¨¡æ¸¬è©¦ï¼ˆ1 é€±ï¼‰

1. **Akamai Staging ç’°å¢ƒé…ç½®**
```bash
# å‰µå»º staging é…ç½®
akamai property-manager create-from-version \
  --property geminiservice \
  --version latest \
  --new-property geminiservice-staging

# æ‡‰ç”¨ç·©å­˜é…ç½®
akamai property-manager update --property geminiservice-staging \
  --file akamai-cache-config.json

# æ¿€æ´»åˆ° staging
akamai property-manager activate --property geminiservice-staging \
  --network staging
```

2. **æ€§èƒ½æ¸¬è©¦**
```bash
# å¾å­Ÿè²·æ¸¬è©¦ staging ç’°å¢ƒ
curl -H "Host: ds-r-staging.geminiservice.cc" \
  https://staging-edge.akamai.net/domains?type=Hash

# å°æ¯”æ¸¬è©¦
./compare-staging-vs-production.sh
```

### éšæ®µ 3: ç”Ÿç”¢ç’°å¢ƒ A/B æ¸¬è©¦ï¼ˆ2 é€±ï¼‰

1. **50% æµé‡ç°åº¦**
2. **å¯†åˆ‡ç›£æ§æŒ‡æ¨™**
3. **æ”¶é›†ç”¨æˆ¶åé¥‹**

### éšæ®µ 4: å…¨é‡éƒ¨ç½²ï¼ˆ1 å¤©ï¼‰

1. **100% æµé‡åˆ‡æ›**
2. **æŒçºŒç›£æ§ 1 é€±**

---

## ğŸ“Š é æœŸæˆæœç¸½çµ

| æŒ‡æ¨™ | ç•¶å‰ | ç·©å­˜å¾Œ | æ”¹å–„å¹…åº¦ |
|------|------|--------|---------|
| **å­Ÿè²· API å»¶é²** | 350ms | 1-5ms | **98.6%** â­â­â­â­â­ |
| **å­Ÿè²·é é¢åŠ è¼‰** | 28s | 10-12s | **57-64%** â­â­â­â­â­ |
| **æºæœå‹™å™¨ QPS** | 10,000/å¤© | 300/å¤© | **97%** â­â­â­â­â­ |
| **æ•¸æ“šåº«è² è¼‰** | 10,000 æŸ¥è©¢/å¤© | 300 æŸ¥è©¢/å¤© | **97%** â­â­â­â­â­ |
| **è·¨å€åŸŸå¸¶å¯¬** | 20 MB/å¤© | 0.6 MB/å¤© | **97%** â­â­â­â­â­ |
| **CDN æˆæœ¬** | ç„¡å¢é‡ | ç„¡å¢é‡ | **0** |
| **å¯¦æ–½é¢¨éšª** | - | ä½ | âš ï¸âš ï¸ |
| **å¯¦æ–½æˆæœ¬** | - | $600 ä¸€æ¬¡æ€§ + $10/æœˆ | ğŸ’°ğŸ’° |
| **ROI** | - | 6-12 å€‹æœˆå›æœ¬ | ğŸ“ˆğŸ“ˆğŸ“ˆ |

---

## ğŸ’¡ æœ€çµ‚å»ºè­°

### å¦‚æœ API æ˜¯ç´”é…ç½®æ•¸æ“šï¼ˆæ¨è–¦å•Ÿç”¨ç·©å­˜ï¼‰

**çµè«–**: âœ… **å¼·çƒˆå»ºè­°å•Ÿç”¨ç·©å­˜**

**ç†ç”±**:
1. æ€§èƒ½æ”¹å–„é¡¯è‘—ï¼ˆ97-99%ï¼‰
2. æˆæœ¬ç¯€çœæ˜é¡¯ï¼ˆå¸¶å¯¬ã€æœå‹™å™¨è² è¼‰ï¼‰
3. ç”¨æˆ¶é«”é©—å¤§å¹…æå‡ï¼ˆ28s â†’ 12sï¼‰
4. å¯¦æ–½é¢¨éšªä½
5. å¯éš¨æ™‚å›æ»¾

**å»ºè­° TTL**:
- `/domains` API: 5 åˆ†é˜
- `/gameInfo` API: 10 åˆ†é˜

---

### å¦‚æœ API åŒ…å«ç”¨æˆ¶æ•¸æ“šï¼ˆéœ€è¦æ‹†åˆ†ï¼‰

**çµè«–**: âš ï¸ **éœ€è¦å…ˆæ‹†åˆ† APIï¼Œå†å•Ÿç”¨ç·©å­˜**

**è¡Œå‹•æ­¥é©Ÿ**:
1. æ‹†åˆ† APIï¼ˆé…ç½® vs ç”¨æˆ¶æ•¸æ“šï¼‰
2. å°é…ç½® API å•Ÿç”¨å…¬å…±ç·©å­˜
3. å°ç”¨æˆ¶ API ä½¿ç”¨ç§æœ‰ç·©å­˜æˆ–ä¸ç·©å­˜

---

### å¦‚æœä¸ç¢ºå®šï¼ˆå»ºè­°æ¸¬è©¦ï¼‰

**çµè«–**: ğŸ§ª **åŸ·è¡Œ A/B æ¸¬è©¦å¾Œæ±ºç­–**

**æ¸¬è©¦è¨ˆåŠƒ**:
1. ç”¨ 2 é€±æ™‚é–“é€²è¡Œ A/B æ¸¬è©¦
2. æ”¶é›†æ€§èƒ½å’Œæ¥­å‹™æ•¸æ“š
3. åŸºæ–¼å¯¦éš›æ•¸æ“šåšæœ€çµ‚æ±ºç­–

---

**ä¸‹ä¸€æ­¥**: è«‹æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼Œæˆ‘å°‡çµ¦å‡ºç²¾ç¢ºå»ºè­°ï¼š

1. é€™å…©å€‹ API çš„å¯¦éš›éŸ¿æ‡‰ç¯„ä¾‹ï¼ˆè„«æ•å¾Œï¼‰
2. API æ›´æ–°é »ç‡ï¼ˆå¤šä¹…æ›´æ–°ä¸€æ¬¡é…ç½®ï¼Ÿï¼‰
3. æ¥­å‹™å¯æ¥å—çš„æ•¸æ“šå»¶é²æ™‚é–“
4. æ˜¯å¦æœ‰ç·Šæ€¥æ›´æ–°é…ç½®çš„éœ€æ±‚

**ç«‹å³å¯åš**: åŸ·è¡Œä¸€è‡´æ€§æ¸¬è©¦è…³æœ¬ï¼ˆæˆ‘å¯ä»¥å¹«æ‚¨ç”Ÿæˆï¼‰
