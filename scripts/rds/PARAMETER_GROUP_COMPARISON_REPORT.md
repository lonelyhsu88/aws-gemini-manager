# RDS åƒæ•¸çµ„æ¯”è¼ƒå ±å‘Š

## ğŸ“Š åŸ·è¡Œæ‘˜è¦

**è‡ªå®šç¾©åƒæ•¸çµ„**: `postgresql14-monitoring-params-postgresmonitoringparametergroup-mywcenlqp0z2`
**é è¨­åƒæ•¸çµ„**: `default.postgres14`
**PostgreSQL ç‰ˆæœ¬**: 14

### ä¿®æ”¹çµ±è¨ˆ

| é¡åˆ¥ | æ•¸é‡ | ä½”æ¯” |
|------|------|------|
| ğŸ” ç›£æ§èˆ‡çµ±è¨ˆåƒæ•¸ | 5 | 16.7% |
| ğŸ“ æ—¥èªŒè¨˜éŒ„åƒæ•¸ | 14 | 46.7% |
| âš¡ æ€§èƒ½èª¿æ ¡åƒæ•¸ | 5 | 16.7% |
| ğŸ”§ å…¶ä»–åƒæ•¸ | 6 | 20.0% |
| **ç¸½è¨ˆ** | **30** | **100%** |

### å¥—ç”¨æ–¹å¼

- ğŸ”„ **éœ€è¦é‡å•Ÿ**: 4 å€‹åƒæ•¸ (13.3%)
- âš¡ **ç«‹å³ç”Ÿæ•ˆ**: 26 å€‹åƒæ•¸ (86.7%)

---

## ğŸ” ç›£æ§èˆ‡çµ±è¨ˆåƒæ•¸ (5 å€‹)

é€™äº›åƒæ•¸å•Ÿç”¨äº† PostgreSQL çš„æŸ¥è©¢çµ±è¨ˆå’Œæ´»å‹•è¿½è¹¤åŠŸèƒ½ã€‚

| åƒæ•¸ | è‡ªå®šç¾©å€¼ | é è¨­å€¼ | èªªæ˜ | å½±éŸ¿ |
|------|---------|--------|------|------|
| `pg_stat_statements.max` | 10000 | (æœªè¨­å®š) | è¿½è¹¤çš„æœ€å¤§ SQL èªå¥æ•¸é‡ | ğŸ”„ éœ€è¦é‡å•Ÿ<br/>å¢åŠ è¨˜æ†¶é«”ä½¿ç”¨ |
| `pg_stat_statements.track` | all | (æœªè¨­å®š) | è¿½è¹¤æ‰€æœ‰ SQL èªå¥ï¼ˆåŒ…æ‹¬å·¢ç‹€ï¼‰ | âš¡ ç«‹å³ç”Ÿæ•ˆ<br/>è¼•å¾®æ•ˆèƒ½å½±éŸ¿ |
| `track_activities` | 1 (å•Ÿç”¨) | (æœªè¨­å®š) | è¿½è¹¤ç•¶å‰åŸ·è¡Œçš„å‘½ä»¤ | âš¡ ç«‹å³ç”Ÿæ•ˆ<br/>å•Ÿç”¨ `pg_stat_activity` è¦–åœ– |
| `track_counts` | 1 (å•Ÿç”¨) | (æœªè¨­å®š) | æ”¶é›†è¡Œç´šçµ±è¨ˆè³‡è¨Š | âš¡ ç«‹å³ç”Ÿæ•ˆ<br/>å¿…è¦åŠŸèƒ½ |
| `track_functions` | all | pl | è¿½è¹¤æ‰€æœ‰å‡½æ•¸åŸ·è¡Œçµ±è¨ˆ | âš¡ ç«‹å³ç”Ÿæ•ˆ<br/>åŒ…å« SQL å’Œ PL å‡½æ•¸ |

**å½±éŸ¿è©•ä¼°**ï¼š
- âœ… **å„ªé»**: å®Œæ•´çš„æŸ¥è©¢åˆ†æèƒ½åŠ›ï¼Œå¯æ‰¾å‡ºæ…¢æŸ¥è©¢å’Œæ•ˆèƒ½ç“¶é ¸
- âš ï¸ **ç¼ºé»**: `pg_stat_statements.max=10000` æœƒå¢åŠ ç´„ 10-20 MB å…±äº«è¨˜æ†¶é«”ä½¿ç”¨

---

## ğŸ“ æ—¥èªŒè¨˜éŒ„åƒæ•¸ (14 å€‹)

å¤§å¹…å¢å¼·äº†æ—¥èªŒè¨˜éŒ„åŠŸèƒ½ï¼Œç”¨æ–¼ç›£æ§å’Œå•é¡Œè¨ºæ–·ã€‚

### æŸ¥è©¢æ—¥èªŒ

| åƒæ•¸ | è‡ªå®šç¾©å€¼ | é è¨­å€¼ | èªªæ˜ |
|------|---------|--------|------|
| `log_statement` | all | (æœªè¨­å®š) | è¨˜éŒ„æ‰€æœ‰ SQL èªå¥ |
| `log_min_duration_statement` | 1000 ms | (æœªè¨­å®š) | è¨˜éŒ„åŸ·è¡Œè¶…é 1 ç§’çš„æŸ¥è©¢ |

âš ï¸ **é‡è¦**: `log_statement: all` æœƒè¨˜éŒ„**æ¯ä¸€æ¢** SQLï¼ŒåŒ…æ‹¬ SELECTã€INSERTã€UPDATEã€DELETE ç­‰ï¼Œå¯èƒ½ç”¢ç”Ÿ**å¤§é‡æ—¥èªŒ**ã€‚

**å»ºè­°**ï¼š
- æ¸¬è©¦/é–‹ç™¼ç’°å¢ƒ: `all` (å®Œæ•´è¨˜éŒ„)
- ç”Ÿç”¢ç’°å¢ƒ: `mod` (åªè¨˜éŒ„è³‡æ–™ä¿®æ”¹èªå¥) æˆ– `ddl` (åªè¨˜éŒ„çµæ§‹è®Šæ›´)

### é€£æ¥æ—¥èªŒ

| åƒæ•¸ | è‡ªå®šç¾©å€¼ | èªªæ˜ |
|------|---------|------|
| `log_connections` | 1 (å•Ÿç”¨) | è¨˜éŒ„æ¯å€‹å®¢æˆ¶ç«¯é€£æ¥å˜—è©¦ |
| `log_disconnections` | 1 (å•Ÿç”¨) | è¨˜éŒ„æœƒè©±çµ‚æ­¢åŠæŒçºŒæ™‚é–“ |

**ç”¨é€”**: ç›£æ§é€£æ¥æ¨¡å¼ã€æª¢æ¸¬ç•°å¸¸é€£æ¥è¡Œç‚º

### æ•ˆèƒ½è¨ºæ–·æ—¥èªŒ

| åƒæ•¸ | è‡ªå®šç¾©å€¼ | èªªæ˜ |
|------|---------|------|
| `log_lock_waits` | 1 (å•Ÿç”¨) | è¨˜éŒ„é–ç­‰å¾…äº‹ä»¶ |
| `log_temp_files` | 0 | è¨˜éŒ„æ‰€æœ‰æš«å­˜æª”æ¡ˆä½¿ç”¨ï¼ˆ0 = å…¨éƒ¨è¨˜éŒ„ï¼‰ |
| `log_autovacuum_min_duration` | 250 ms | è¨˜éŒ„è¶…é 250ms çš„ autovacuum æ“ä½œ |

**ç”¨é€”**:
- è­˜åˆ¥æ­»é–å’Œé–ç«¶çˆ­
- ç™¼ç¾ä½¿ç”¨ç£ç¢Ÿæ’åºçš„æŸ¥è©¢
- ç›£æ§è‡ªå‹•æ¸…ç†å½±éŸ¿

### Auto Explain åƒæ•¸

Auto Explain æœƒè‡ªå‹•è¨˜éŒ„æ…¢æŸ¥è©¢çš„åŸ·è¡Œè¨ˆç•«ï¼ˆEXPLAIN ANALYZEï¼‰ã€‚

| åƒæ•¸ | è‡ªå®šç¾©å€¼ | èªªæ˜ |
|------|---------|------|
| `auto_explain.log_analyze` | 1 | åŒ…å«å¯¦éš›åŸ·è¡Œæ™‚é–“å’Œè¡Œæ•¸ |
| `auto_explain.log_buffers` | 1 | åŒ…å«ç·©è¡å€ä½¿ç”¨è³‡è¨Š |
| `auto_explain.log_timing` | 1 | åŒ…å«æ¯å€‹ç¯€é»çš„æ™‚é–“ |
| `auto_explain.log_triggers` | 1 | åŒ…å«è§¸ç™¼å™¨åŸ·è¡Œæ™‚é–“ |
| `auto_explain.log_verbose` | 1 | è©³ç´°è¼¸å‡º |
| `auto_explain.log_nested_statements` | 1 | åŒ…å«å·¢ç‹€èªå¥ |
| `auto_explain.log_format` | text | æ–‡å­—æ ¼å¼è¼¸å‡º |

**è§¸ç™¼æ¢ä»¶**: é…åˆ `log_min_duration_statement=1000`ï¼ŒåŸ·è¡Œè¶…é 1 ç§’çš„æŸ¥è©¢æœƒè‡ªå‹•è¨˜éŒ„åŸ·è¡Œè¨ˆç•«ã€‚

---

## âš¡ æ€§èƒ½èª¿æ ¡åƒæ•¸ (5 å€‹)

### Autovacuum è¨­å®š

| åƒæ•¸ | è‡ªå®šç¾©å€¼ | é è¨­å€¼ | èªªæ˜ |
|------|---------|--------|------|
| `autovacuum` | 1 (å•Ÿç”¨) | (é è¨­å•Ÿç”¨) | å•Ÿç”¨è‡ªå‹•æ¸…ç† |
| `log_autovacuum_min_duration` | 250 ms | 10000 ms | é™ä½è¨˜éŒ„é–¾å€¼ï¼ˆå¾ 10 ç§’é™è‡³ 250 æ¯«ç§’ï¼‰ |

**å½±éŸ¿**: æ›´é »ç¹è¨˜éŒ„ autovacuum æ´»å‹•ï¼Œä¾¿æ–¼ç›£æ§

### Shared Preload Libraries

| åƒæ•¸ | è‡ªå®šç¾©å€¼ | é è¨­å€¼ |
|------|---------|--------|
| `shared_preload_libraries` | `pg_stat_statements,auto_explain` | `pg_stat_statements` |

ğŸ”„ **éœ€è¦é‡å•Ÿ**

**è®Šæ›´**: æ–°å¢ `auto_explain` æ“´å±•

**ç”¨é€”**:
- `pg_stat_statements`: æŸ¥è©¢çµ±è¨ˆ
- `auto_explain`: è‡ªå‹•åŸ·è¡Œè¨ˆç•«è¨˜éŒ„

### Standby/Replica è¨­å®š

| åƒæ•¸ | è‡ªå®šç¾©å€¼ | é è¨­å€¼ | èªªæ˜ |
|------|---------|--------|------|
| `max_standby_archive_delay` | 60 ms | (æœªè¨­å®š) | WAL æ­¸æª”æ‡‰ç”¨å»¶é²ä¸Šé™ |
| `max_standby_streaming_delay` | 60 ms | (æœªè¨­å®š) | ä¸²æµè¤‡è£½æ‡‰ç”¨å»¶é²ä¸Šé™ |
| `max_slot_wal_keep_size` | -1 (ç„¡é™) | (æœªè¨­å®š) | è¤‡è£½æ§½ä¿ç•™çš„ WAL å¤§å° |

**ç”¨é€”**: ç”¨æ–¼ Read Replica çš„è¤‡è£½å»¶é²æ§åˆ¶

---

## ğŸ”§ å…¶ä»–åƒæ•¸ (6 å€‹)

### é‚è¼¯è¤‡è£½

| åƒæ•¸ | è‡ªå®šç¾©å€¼ | é è¨­å€¼ | èªªæ˜ |
|------|---------|--------|------|
| `rds.logical_replication` | 1 (å•Ÿç”¨) | 0 (åœç”¨) | å•Ÿç”¨é‚è¼¯è¤‡è£½ |

ğŸ”„ **éœ€è¦é‡å•Ÿ**

**ç”¨é€”**:
- è³‡æ–™åº«é·ç§»ï¼ˆå¦‚ AWS DMSï¼‰
- Change Data Capture (CDC)
- è·¨ç‰ˆæœ¬è¤‡è£½

### æŸ¥è©¢å„ªåŒ–

| åƒæ•¸ | è‡ªå®šç¾©å€¼ | èªªæ˜ |
|------|---------|------|
| `pg_hint_plan.enable_hint` | 1 (å•Ÿç”¨) | å•Ÿç”¨æŸ¥è©¢æç¤ºåŠŸèƒ½ï¼ˆæ‰‹å‹•å¹²é åŸ·è¡Œè¨ˆç•«ï¼‰ |

**ç”¨é€”**: å…è¨±ä½¿ç”¨ç‰¹æ®Šè¨»è§£å¼·åˆ¶ PostgreSQL ä½¿ç”¨ç‰¹å®šåŸ·è¡Œè¨ˆç•«

### é ç†±ç·©å­˜

| åƒæ•¸ | è‡ªå®šç¾©å€¼ | èªªæ˜ |
|------|---------|------|
| `pg_prewarm.autoprewarm` | 1 (å•Ÿç”¨) | è‡ªå‹•é ç†±ç·©å­˜ |
| `pg_prewarm.autoprewarm_interval` | 300 ç§’ | æ¯ 5 åˆ†é˜ä¿å­˜ä¸€æ¬¡ç·©å­˜ç‹€æ…‹ |

ğŸ”„ `pg_prewarm.autoprewarm` **éœ€è¦é‡å•Ÿ**

**ç”¨é€”**: é‡å•Ÿå¾Œè‡ªå‹•è¼‰å…¥å¸¸ç”¨è³‡æ–™åˆ°è¨˜æ†¶é«”ï¼Œæ¸›å°‘å†·å•Ÿå‹•æ™‚é–“

### Standby é…ç½®

| åƒæ•¸ | è‡ªå®šç¾©å€¼ | èªªæ˜ |
|------|---------|------|
| `hot_standby_feedback` | 1 (å•Ÿç”¨) | Standby å‘ Primary å›å ±æŸ¥è©¢ç‹€æ…‹ï¼Œæ¸›å°‘æŸ¥è©¢è¡çª |
| `wal_sender_timeout` | 0 (åœç”¨) | WAL ç™¼é€è¶…æ™‚è¨­å®šï¼ˆ0 = æ°¸ä¸è¶…æ™‚ï¼‰ |

**ç”¨é€”**: æ”¹å–„ Read Replica çš„ç©©å®šæ€§

---

## ğŸ“Š éœ€è¦é‡å•Ÿçš„åƒæ•¸è©³æƒ…

ä»¥ä¸‹ **4 å€‹åƒæ•¸éœ€è¦é‡å•Ÿ** RDS å¯¦ä¾‹æ‰èƒ½ç”Ÿæ•ˆï¼š

| # | åƒæ•¸ | è‡ªå®šç¾©å€¼ | å½±éŸ¿ |
|---|------|---------|------|
| 1 | `shared_preload_libraries` | `pg_stat_statements,auto_explain` | è¼‰å…¥æ“´å±•æ¨¡çµ„ |
| 2 | `pg_stat_statements.max` | 10000 | çµ±è¨ˆå®¹é‡ä¸Šé™ |
| 3 | `rds.logical_replication` | 1 | å•Ÿç”¨é‚è¼¯è¤‡è£½ |
| 4 | `pg_prewarm.autoprewarm` | 1 | å•Ÿç”¨è‡ªå‹•ç·©å­˜é ç†± |

**é‡å•Ÿå½±éŸ¿**ï¼š
- â±ï¸ åœæ©Ÿæ™‚é–“: 5-10 åˆ†é˜
- ğŸ”Œ é€£æ¥ä¸­æ–·: æ‰€æœ‰ç¾æœ‰é€£æ¥æœƒæ–·é–‹
- ğŸ’¾ è³‡æ–™å®‰å…¨: âœ… PostgreSQL æ­£å¸¸é—œé–‰ï¼Œè³‡æ–™å®Œæ•´æ€§ç„¡å½±éŸ¿

---

## ğŸ’° æˆæœ¬èˆ‡æ•ˆèƒ½å½±éŸ¿

### CloudWatch Logs æˆæœ¬

å•Ÿç”¨ `log_statement: all` æœƒç”¢ç”Ÿ**å¤§é‡æ—¥èªŒ**ï¼š

**é ä¼°æ—¥èªŒé‡**ï¼ˆä¾æŸ¥è©¢é »ç‡è€Œå®šï¼‰ï¼š
- ä½æµé‡: 10-50 MB/å¤©
- ä¸­æµé‡: 100-500 MB/å¤©
- é«˜æµé‡: 1-5 GB/å¤© æˆ–æ›´å¤š

**CloudWatch Logs å®šåƒ¹** (ap-east-1 é¦™æ¸¯å€åŸŸ)ï¼š
- å„²å­˜: $0.033 USD/GB/æœˆ
- å‚³è¼¸: $0.033 USD/GB

**å»ºè­°**ï¼š
- è¨­å®šæ—¥èªŒä¿ç•™æœŸé™ï¼ˆå¦‚ 7-30 å¤©ï¼‰
- ç”Ÿç”¢ç’°å¢ƒè€ƒæ…®æ”¹ç”¨ `log_statement: mod` æˆ– `ddl`
- ä½¿ç”¨ `log_min_duration_statement` åªè¨˜éŒ„æ…¢æŸ¥è©¢

### è¨˜æ†¶é«”ä½¿ç”¨

| åƒæ•¸ | é¡å¤–è¨˜æ†¶é«”ä½¿ç”¨ |
|------|--------------|
| `pg_stat_statements.max: 10000` | ~10-20 MB |
| `auto_explain` | æœ€å°å½±éŸ¿ |
| `pg_prewarm.autoprewarm` | ä¾è³‡æ–™åº«å¤§å°è€Œå®š |

**ç¸½é«”å½±éŸ¿**: è¨˜æ†¶é«”å¢åŠ  < 1%ï¼ˆå°æ–¼å¤§å¤šæ•¸å¯¦ä¾‹é¡å‹ï¼‰

### CPU æ•ˆèƒ½

| åŠŸèƒ½ | CPU å½±éŸ¿ |
|------|---------|
| `log_statement: all` | âš ï¸ ä¸­åº¦å½±éŸ¿ï¼ˆ2-5%ï¼‰ |
| `auto_explain` | è¼•å¾®å½±éŸ¿ï¼ˆåƒ…æ…¢æŸ¥è©¢ï¼‰ |
| `pg_stat_statements` | æœ€å°å½±éŸ¿ï¼ˆ<1%ï¼‰ |
| `track_io_timing` | (æœªåœ¨æ­¤åƒæ•¸çµ„å•Ÿç”¨) |

---

## ğŸ¯ å»ºè­°å„ªåŒ–

### 1. ç”Ÿç”¢ç’°å¢ƒå»ºè­°èª¿æ•´

```yaml
# é™ä½æ—¥èªŒé‡
log_statement: 'mod'  # åªè¨˜éŒ„ INSERT/UPDATE/DELETE
log_min_duration_statement: '5000'  # åªè¨˜éŒ„ >5 ç§’çš„æŸ¥è©¢

# ä¿ç•™å…¶ä»–ç›£æ§åŠŸèƒ½
pg_stat_statements.track: 'all'  # ä¿æŒ
auto_explain: å•Ÿç”¨  # ä¿æŒ
```

### 2. é–‹ç™¼/æ¸¬è©¦ç’°å¢ƒ

```yaml
# å®Œæ•´æ—¥èªŒï¼ˆç›®å‰è¨­å®šï¼‰
log_statement: 'all'
log_min_duration_statement: '1000'
```

### 3. CloudWatch Logs ä¿ç•™ç­–ç•¥

```bash
# è¨­å®šæ—¥èªŒä¿ç•™æœŸç‚º 7 å¤©
aws logs put-retention-policy \
    --log-group-name /aws/rds/instance/pgsqlrel/postgresql \
    --retention-in-days 7 \
    --profile gemini-pro_ck
```

---

## ğŸ“‹ å¥—ç”¨æª¢æŸ¥æ¸…å–®

ç•¶ `pgsqlrel` å¯¦ä¾‹é‡å•Ÿå¾Œï¼Œé©—è­‰ä»¥ä¸‹é …ç›®ï¼š

- [ ] åƒæ•¸ç‹€æ…‹è®Šæ›´ç‚º `in-sync`
- [ ] `pg_stat_statements` æ“´å±•å¯ç”¨ï¼ˆ`SELECT * FROM pg_stat_statements LIMIT 1;`ï¼‰
- [ ] `auto_explain` æ­£å¸¸å·¥ä½œï¼ˆè§€å¯Ÿæ…¢æŸ¥è©¢æ—¥èªŒï¼‰
- [ ] é‚è¼¯è¤‡è£½åŠŸèƒ½å¯ç”¨ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰
- [ ] CloudWatch Logs æœ‰æ–°æ—¥èªŒç”¢ç”Ÿ
- [ ] ç›£æ§æ—¥èªŒé‡å’Œæˆæœ¬
- [ ] æª¢æŸ¥æ‡‰ç”¨ç¨‹å¼æ•ˆèƒ½æ˜¯å¦å—å½±éŸ¿

---

## ğŸ“š åƒè€ƒè³‡æº

- [AWS RDS for PostgreSQL åƒæ•¸çµ„](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Appendix.PostgreSQL.CommonDBATasks.Parameters.html)
- [PostgreSQL 14 é…ç½®åƒæ•¸](https://www.postgresql.org/docs/14/runtime-config.html)
- [pg_stat_statements æ–‡ä»¶](https://www.postgresql.org/docs/14/pgstatstatements.html)
- [auto_explain æ–‡ä»¶](https://www.postgresql.org/docs/14/auto-explain.html)
- [CloudWatch Logs å®šåƒ¹](https://aws.amazon.com/cloudwatch/pricing/)

---

**å ±å‘Šç”Ÿæˆæ™‚é–“**: 2025-11-03
**åˆ†æå·¥å…·**: Python + Boto3 + AWS RDS API
**AWS Profile**: gemini-pro_ck
**è…³æœ¬**: `scripts/rds/compare-parameter-groups.py`
