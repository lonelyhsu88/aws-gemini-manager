# pgsqlrel åƒæ•¸çµ„ pending-reboot æ·±åº¦åˆ†æ

## ğŸ“Š åŸ·è¡Œæ‘˜è¦

æ ¹æ“šæ·±å…¥èª¿æŸ¥ï¼Œ`pgsqlrel` å¯¦ä¾‹é¡¯ç¤º `pending-reboot` ç‹€æ…‹çš„åŸå› å·²ç¶“æ‰¾åˆ°ã€‚

## ğŸ” é—œéµç™¼ç¾

### 1. é‡å•Ÿæ­·å²å°æ¯”

| å¯¦ä¾‹ | åƒæ•¸ç‹€æ…‹ | æœ€è¿‘90å¤©é‡å•Ÿè¨˜éŒ„ | å¯¦ä¾‹å‰µå»ºæ™‚é–“ |
|------|---------|----------------|-------------|
| **pgsqlrel** | âš ï¸ **pending-reboot** | **âŒ ç„¡** | 2023-02-23 (æœ€æ—©) |
| pgsqlrel-backstage | âœ… in-sync | âŒ ç„¡ | 2024-03-26 |
| bingo-prd | âœ… in-sync | âœ… 2025-11-03 é‡å•Ÿ | 2023-12-18 |
| bingo-prd-* (å…¶ä»–4å€‹) | âœ… in-sync | âœ… 2025-11-03 é‡å•Ÿ | 2023-2024å¹´ |

### 2. åƒæ•¸çµ„æ™‚é–“ç·š

```
2023-02-23          pgsqlrel å¯¦ä¾‹å‰µå»º (ä½¿ç”¨èˆŠåƒæ•¸çµ„)
    â†“
2024-03-26          pgsqlrel-backstage å‰µå»º
    â†“
2024-11-13 21:39    åƒæ•¸çµ„ postgresql14-monitoring-params é€šé CloudFormation å‰µå»º
    â†“
2024-11-13 ~ ?     æ‰€æœ‰å¯¦ä¾‹ç¶å®šåˆ°æ–°åƒæ•¸çµ„
    â†“
    âŒ              pgsqlrel ç¶å®šå¾Œã€Œæœªé‡å•Ÿã€
    âœ…              pgsqlrel-backstage å‰µå»ºæ™‚ç›´æ¥ä½¿ç”¨æ–°åƒæ•¸çµ„ï¼ˆç„¡éœ€é‡å•Ÿï¼‰
    â†“
2025-11-03 08:08    bingo-prd-* æ‰¹é‡é‡å•Ÿï¼ˆæ‡‰ç”¨åƒæ•¸ï¼‰
    â†“
ç¾åœ¨                pgsqlrel ä»ç‚º pending-reboot
```

## ğŸ’¡ æ ¸å¿ƒåŸå› åˆ†æ

### ç‚ºä»€éº¼ pgsqlrel æ˜¯ pending-rebootï¼Ÿ

**æƒ…å¢ƒé‚„åŸ**ï¼š

1. **2024-11-13** - åƒæ•¸çµ„å‰µå»º
   - CloudFormation å‰µå»ºäº†æ–°çš„åƒæ•¸çµ„
   - æ‰€æœ‰ç¾æœ‰å¯¦ä¾‹è¢«ç¶å®šåˆ°æ­¤åƒæ•¸çµ„

2. **pgsqlrel çš„æƒ…æ³**ï¼š
   - âœ… åƒæ•¸çµ„æˆåŠŸç¶å®š
   - âŒ **å¾æœªé‡å•Ÿ**ï¼ˆCloudTrail 90å¤©å…§ç„¡è¨˜éŒ„ï¼‰
   - âš ï¸ ç‹€æ…‹ä¿æŒ `pending-reboot`

3. **å…¶ä»–å¯¦ä¾‹çš„æƒ…æ³**ï¼š
   - **bingo-prd-* ç³»åˆ—**ï¼šåœ¨ 2025-11-03 æ‰¹é‡é‡å•Ÿ â†’ `in-sync` âœ…
   - **pgsqlrel-backstage**ï¼šåœ¨åƒæ•¸çµ„å‰µå»ºå¾Œï¼ˆ2024-03-26ï¼‰æ‰å‰µå»º â†’ ç›´æ¥ä½¿ç”¨æ–°åƒæ•¸çµ„ï¼Œå‰µå»ºæ™‚å°±æ˜¯ `in-sync` âœ…
   - **bingo-stress-* ç³»åˆ—**ï¼šå¯èƒ½åœ¨å‰µå»ºæ™‚å°±ä½¿ç”¨æ–°åƒæ•¸çµ„ â†’ `in-sync` âœ…

### ç‚ºä»€éº¼ pgsqlrel-backstage æ˜¯ in-syncï¼Ÿ

**é—œéµå·®ç•°**ï¼š
```
pgsqlrel           | å‰µå»ºæ–¼ 2023-02-23 | å¾Œä¾†ç¶å®šåƒæ•¸çµ„ | æœªé‡å•Ÿ | âš ï¸ pending-reboot
pgsqlrel-backstage | å‰µå»ºæ–¼ 2024-03-26 | å‰µå»ºæ™‚å°±ç”¨æ–°åƒæ•¸çµ„ | ç„¡éœ€é‡å•Ÿ | âœ… in-sync
```

**çµè«–**ï¼š`pgsqlrel-backstage` æ˜¯åœ¨åƒæ•¸çµ„å­˜åœ¨å¾Œæ‰å‰µå»ºçš„ï¼Œæ‰€ä»¥ä¸€é–‹å§‹å°±å¥—ç”¨æ­£ç¢ºçš„åƒæ•¸ï¼Œä¸éœ€è¦é‡å•Ÿã€‚

## ğŸ“‹ å¾…æ‡‰ç”¨çš„åƒæ•¸è©³æƒ…

ä»¥ä¸‹åƒæ•¸éœ€è¦é‡å•Ÿæ‰èƒ½ç”Ÿæ•ˆï¼ˆ`ApplyMethod: pending-reboot`ï¼‰ï¼š

### é—œéµç³»çµ±åƒæ•¸
- `shared_preload_libraries: 'pg_stat_statements'` - éœ€è¦åœ¨ä¼ºæœå™¨å•Ÿå‹•æ™‚è¼‰å…¥
- `max_connections` - é€£æ¥æ•¸ä¸Šé™
- `shared_buffers` - å…±äº«ç·©è¡å€å¤§å°
- `effective_cache_size` - æœ‰æ•ˆå¿«å–å¤§å°
- `huge_pages: 'on'` - å¤§é é¢æ”¯æ´
- `jit: '0'` - é—œé–‰ JIT ç·¨è­¯

### ç›£æ§åƒæ•¸
- `log_statement: 'all'` - è¨˜éŒ„æ‰€æœ‰ SQL èªå¥
- `log_checkpoints: '1'` - è¨˜éŒ„æª¢æŸ¥é»
- `track_activities`, `track_counts`, `track_io_timing` ç­‰

### Autovacuum åƒæ•¸
- `autovacuum_max_workers` - è‡ªå‹•æ¸…ç†å·¥ä½œç¨‹åºæ•¸
- `autovacuum_naptime: '15'` - è‡ªå‹•æ¸…ç†é–“éš”
- `log_autovacuum_min_duration: '250'` - è¨˜éŒ„é–¾å€¼

## âš ï¸ ç‚ºä»€éº¼ä¸€ç›´æ²’é‡å•Ÿï¼Ÿ

æ ¹æ“šèª¿æŸ¥ï¼Œpgsqlrel è‡ªå¾ç¶å®šæ–°åƒæ•¸çµ„å¾Œå°±æ²’æœ‰é‡å•Ÿéï¼Œå¯èƒ½çš„åŸå› ï¼š

1. **æ¥­å‹™é—œéµæ€§**ï¼špgsqlrel å¯èƒ½æ˜¯æ ¸å¿ƒè³‡æ–™åº«ï¼Œä¸èƒ½éš¨æ„é‡å•Ÿ
2. **ç–å¿½éºæ¼**ï¼šåœ¨ 2025-11-03 æ‰¹é‡é‡å•Ÿæ™‚è¢«éºæ¼
3. **åˆ»æ„ä¿ç•™**ï¼šç­‰å¾…åˆé©çš„ç¶­è­·çª—å£

## ğŸ¯ è§£æ±ºæ–¹æ¡ˆ

### é¸é … 1ï¼šç«‹å³é‡å•Ÿï¼ˆæ¨è–¦ï¼‰

```bash
# é‡å•Ÿ pgsqlrel å¯¦ä¾‹
aws --profile gemini-pro_ck rds reboot-db-instance \
    --db-instance-identifier pgsqlrel

# ç­‰å¾…å¹¾åˆ†é˜å¾Œé©—è­‰ç‹€æ…‹
aws --profile gemini-pro_ck rds describe-db-instances \
    --db-instance-identifier pgsqlrel \
    --query 'DBInstances[0].{Instance:DBInstanceIdentifier,Status:DBInstanceStatus,ParamStatus:DBParameterGroups[0].ParameterApplyStatus}'
```

**é æœŸçµæœ**ï¼š
- é‡å•Ÿæ™‚é–“ï¼šç´„ 5-10 åˆ†é˜
- é‡å•Ÿå¾Œï¼š`ParameterApplyStatus` è®Šç‚º `in-sync` âœ…

### é¸é … 2ï¼šç¶­è­·çª—å£é‡å•Ÿ

å¦‚æœ pgsqlrel æ˜¯ç”Ÿç”¢é—œéµç³»çµ±ï¼Œå¯ä»¥ï¼š

1. è¨­å®šç¶­è­·çª—å£
2. åœ¨æ¥­å‹™ä½å³°æœŸé‡å•Ÿ
3. æå‰é€šçŸ¥ç›¸é—œäººå“¡

```bash
# è¨­å®šç¶­è­·çª—å£ï¼ˆä¾‹å¦‚ï¼šæ¯é€±æ—¥ 02:00-03:00 UTCï¼‰
aws --profile gemini-pro_ck rds modify-db-instance \
    --db-instance-identifier pgsqlrel \
    --preferred-maintenance-window sun:02:00-sun:03:00 \
    --apply-immediately

# åœ¨ç¶­è­·çª—å£å…§é‡å•Ÿ
aws --profile gemini-pro_ck rds reboot-db-instance \
    --db-instance-identifier pgsqlrel
```

## ğŸ“Š å½±éŸ¿è©•ä¼°

### é‡å•Ÿçš„å½±éŸ¿

1. **åœæ©Ÿæ™‚é–“**ï¼š5-10 åˆ†é˜ï¼ˆä¸å¯ç”¨ï¼‰
2. **é€£æ¥ä¸­æ–·**ï¼šæ‰€æœ‰ç¾æœ‰é€£æ¥æœƒæ–·é–‹
3. **æ‡‰ç”¨å±¤**ï¼šéœ€è¦é‡æ–°å»ºç«‹è³‡æ–™åº«é€£æ¥
4. **æ•¸æ“šå®Œæ•´æ€§**ï¼šâœ… ç„¡å½±éŸ¿ï¼ˆPostgreSQL æœƒæ­£å¸¸é—œé–‰ï¼‰

### æ‡‰ç”¨åƒæ•¸å¾Œçš„æ•ˆæœ

1. **ç›£æ§æ”¹å–„**ï¼š
   - âœ… å•Ÿç”¨ `pg_stat_statements` - å¯ä»¥åˆ†ææŸ¥è©¢æ•ˆèƒ½
   - âœ… è©³ç´°çš„é€£æ¥å’Œé–æ—¥èªŒ
   - âœ… Autovacuum ç›£æ§

2. **å¯èƒ½çš„æ€§èƒ½å½±éŸ¿**ï¼š
   - âš ï¸ `log_statement: 'all'` æœƒç”¢ç”Ÿå¤§é‡æ—¥èªŒï¼ˆå¯èƒ½å½±éŸ¿æ•ˆèƒ½ï¼‰
   - âš ï¸ CloudWatch Logs è²»ç”¨å¢åŠ 

## ğŸ”§ å»ºè­°è¡Œå‹•

### ç«‹å³è¡Œå‹•ï¼ˆå¦‚æœå¯ä»¥ï¼‰
1. é¸æ“‡æ¥­å‹™ä½å³°æ™‚æ®µ
2. é€šçŸ¥ç›¸é—œäººå“¡
3. åŸ·è¡Œé‡å•Ÿ
4. é©—è­‰åƒæ•¸æ‡‰ç”¨æˆåŠŸ

### å¾ŒçºŒè¿½è¹¤
1. ç›£æ§é‡å•Ÿå¾Œçš„ç³»çµ±æ•ˆèƒ½
2. æª¢æŸ¥æ—¥èªŒé‡æ˜¯å¦éå¤§
3. è©•ä¼°æ˜¯å¦éœ€è¦èª¿æ•´ `log_statement` åƒæ•¸ï¼ˆå¾ 'all' æ”¹ç‚º 'mod'ï¼‰

## ğŸ“ çµè«–

**pgsqlrel çš„ `pending-reboot` ç‹€æ…‹æ˜¯æ­£å¸¸çš„**ï¼Œå› ç‚ºï¼š
- âœ… åƒæ•¸çµ„åœ¨ 2024-11-13 å‰µå»ºä¸¦ç¶å®š
- âœ… ç¶å®šæˆåŠŸï¼Œä½†å¾æœªé‡å•Ÿ
- âŒ å…¶ä»–å¯¦ä¾‹åœ¨ 2025-11-03 é‡å•Ÿäº†ï¼Œpgsqlrel æ²’æœ‰
- âš ï¸ éœ€è¦é‡å•Ÿæ‰èƒ½æ‡‰ç”¨åƒæ•¸è®Šæ›´

**å»ºè­°**ï¼šé¸æ“‡åˆé©çš„æ™‚é–“é‡å•Ÿ pgsqlrelï¼Œä½¿åƒæ•¸ç”Ÿæ•ˆã€‚

---

**åˆ†ææ™‚é–“**ï¼š2025-11-03
**åˆ†æå·¥å…·**ï¼šAWS CLI + CloudTrail + RDS API
**AWS Profile**ï¼šgemini-pro_ck
